<template>
  <div>
    <a-modal
      width="70%"
      :visible="visible"
      :confirmLoading="loading"
      @cancel="closeForm"
      :keyboard="false"
      :maskClosable="false"
    >
      <a-spin :spinning="loading">
        <div class="header-title">{{ modalTitle }}</div>
        <a-table
          size="default"
          :columns="columns"
          :data-source="dataSource"
          :pagination="false"
          :rowSelection="rowSelection"
          :rowKey="record => record.id"
        >
        </a-table>
      </a-spin>
      <template slot="footer">
        <a-button type="primary" @click="submitForm" v-if="!disabled">确定</a-button>
        <a-button @click="closeForm">取消</a-button>
      </template>
    </a-modal>
  </div>

</template>

<script>

  import { LColumns, SColumns } from '../columns'
  import URLS from '@/api/risk-urls'
  export default {
    name: 'LSSelectModal',
    components: {
    },
    props: {
      visible: {
        type: Boolean,
        required: true
      },
      loading: {
        type: Boolean,
        default: () => false
      },
      modalTitle: {
        type: String,
        default: ''
      },
      disabled: {
        type: Boolean,
        default: () => false
      },
      mode: {
        type: String,
        default: 'L',
        required: true,
        validator: (value) => (['L', 'S'].indexOf(value) !== -1)
      }
    },
    data () {
      return {
        selectedRowKeys: [],
        selectedRows: [],
        dataSource: []
      }
    },
    computed: {
      columns () {
        if (this.mode === 'L') {
          return LColumns
        } else if (this.mode === 'S') {
          return SColumns
        } else {
          return []
        }
      },
      hasSelected () {
        return this.selectedRowKeys.length > 0
      },
      rowSelection () {
        return {
          type: 'radio',
          selectedRowKeys: this.selectedRowKeys,
          onChange: this.onSelectChange
        }
      }
    },
    watch: {
      mode (mode) {
        if (mode === 'L') {
          this.getLData()
        } else {
          this.getSData()
        }
      }
    },
    methods: {
      getLData () {
        this.getList(URLS.lList).then(({ data, success }) => {
          if (success) {
            this.dataSource = data
          }
        })
      },
      getSData () {
        this.getList(URLS.sList).then(({ data, success }) => {
          if (success) {
            this.dataSource = data
          }
        })
      },
      onSelectChange (selectedRowKeys, selectedRows) {
        this.selectedRowKeys = selectedRowKeys
        this.selectedRows = selectedRows
      },
      closeForm () {
        this.$emit('update:visible', false)
        this.$emit('cancel')
      },
      submitForm () {
        if (this.selectedRowKeys.length > 0) {
          this.$emit('update:visible', false)
          this.$emit('ok', this.selectedRows[0])
        }
      }
    },
    created () {

    }
  }
</script>
<style lang="less" scoped>
  .header-title {
    font-size: 16px;
    color: blue;
  }

  /deep/ .ant-table {
    height: auto !important;
  }
  /deep/ .ant-modal-body {
    max-height: 700px;
    overflow-y: auto;
  }
</style>
