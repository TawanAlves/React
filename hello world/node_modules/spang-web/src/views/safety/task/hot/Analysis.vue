<template>
  <div>
    <a-card title="基本信息" style="margin: 15px;">
      <a-form class="ant-advanced-search-form">
        <a-row :gutter="24">
          <a-col :span="12">
            <a-form-item label="取样位置">
              <a-input :value="lastAnalysis.samplePoint" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="12">
            <a-form-item label="分析时间">
              <a-input :value="lastAnalysis.analysisTime" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="12" v-for="(item, index) in lastAnalysis.workTicketNoxiousGasList" :key="index">
            <a-form-item label="有害气体">
              <a-input :value="item.gasName + '      测量值:' + item.assessValue" disabled/>
            </a-form-item>
          </a-col>
        </a-row>
      </a-form>
      <a-table
        ref="table"
        size="default"
        :rowKey="(index) => (index)"
        :columns="lastAnalysisColumns"
        :dataSource="[lastAnalysis]"
        :alert="false"
        :scroll="{ y: 350 }"
        :pagination="false"
      >
        <span slot="operation" slot-scope="text, record, index">
          <a-button v-if="false">查看图片</a-button>
        </span>
        <span slot="sign" slot-scope="text, record">
          <sign-img :src="record.analysisSignURL ? BASE_URL + '/spang-safety/file' + record.analysisSignURL : ''"></sign-img>
        </span>
      </a-table>
    </a-card>
    <a-card title="动火历史分析" style="margin: 15px;">
      <a-table
        ref="table-history"
        size="default"
        :rowKey="(index) => (index)"
        :columns="historyColumns"
        :dataSource="historyList"
        :alert="false"
        :scroll="{ y: 350 }"
        :pagination="false"
      >
        <span slot="operation" slot-scope="text, record, index">
          <a-button v-if="false">查看图片</a-button>
        </span>
        <span slot="sign" slot-scope="text, record, index">
          <sign-img :src="record.analysisSignURL ? BASE_URL + '/spang-safety/file' + record.analysisSignURL : ''"></sign-img>
        </span>
      </a-table>
    </a-card>
  </div>

</template>

<script>
import SignImg from '../component/SignImg'
export default {
  name: 'Analysis',
  components: { SignImg },
  props: {
    ticketId: {
      type: String,
      default: '',
      required: true
    }
  },
  data () {
    return {
      historyList: [],
      lastAnalysis: {},
      lastAnalysisColumns: [
        {
          title: '分析人',
          dataIndex: 'analysisName',
          align: 'center'
        },
        {
          title: '签字时间',
          dataIndex: 'analysisTime',
          align: 'center'
        },
        {
          title: '签字',
          dataIndex: 'analysisSignPic',
          align: 'center',
          scopedSlots: { customRender: 'sign' }
        },
        {
          title: '操作',
          dataIndex: 'operation',
          align: 'center',
          width: '200px',
          colSpan: 0,
          scopedSlots: { customRender: 'operation' }
        }
      ],
      historyColumns: [
        {
          title: '取样位置',
          dataIndex: 'samplePoint',
          align: 'center'
        },
        {
          title: '有害气体',
          dataIndex: 'gases',
          align: 'center'
        },
        {
          title: '测量值',
          dataIndex: 'values',
          align: 'center'
        },
        {
          title: '分析人',
          dataIndex: 'analysisName',
          align: 'center'
        },
        {
          title: '提交时间',
          dataIndex: 'analysisTime',
          align: 'center'
        },
        {
          title: '签字',
          dataIndex: 'analysisSignPic',
          align: 'center',
          scopedSlots: { customRender: 'sign' }
        },
        {
          title: '操作',
          dataIndex: 'operation',
          align: 'center',
          width: '200px',
          colSpan: 0,
          scopedSlots: { customRender: 'operation' }
        }
      ]
    }
  },
  created () {
    this.getById('/spang-safety/workticket/laboratoryanalysis', this.ticketId).then(({ data, code }) => {
      if (code === 200) {
        if (data.length > 0) {
          this.lastAnalysis = data[data.length - 1]
        }
        data.forEach(item => {
          item.gases = item.workTicketNoxiousGasList.map(item => item.gasName).join(',')
          item.values = item.workTicketNoxiousGasList.map(item => item.assessValue).join(',')
        })
        this.historyList = data
      }
    })
  }

}
</script>

<style scoped lang="less">
/deep/ .ant-advanced-search-form .ant-form-item {
  display: flex;
}
/deep/ .ant-advanced-search-form .ant-form-item-label {
  width: 130px;
}

/deep/ .ant-advanced-search-form .ant-form-item-control-wrapper {
  flex: 1;
}
.sign-img {
  width: 72px;
  height: 35px;
}
/deep/ .ant-table {
  height: auto;
}
</style>
