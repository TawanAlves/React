<template>
  <a-card title="审核记录" style="margin: 15px;">
    <approve-list :history-datas="historyDatas"></approve-list>
    <div class="measure-title">班长验票</div>
    <a-divider />
    <signature-list :list-data="signData" :is-show-image="true"></signature-list>
  </a-card>
</template>

<script>
import ApproveList from '../component/ApproveList'
import SignatureList from '../component/SignatureList'
export default {
  name: 'Approval',
  components: { ApproveList, SignatureList },
  props: {
    ticketId: {
      type: String,
      default: '',
      required: true
    }
  },
  data () {
    return {
      historyDatas: [],
      signData: []
    }
  },
  methods: {
    getHistory () {
      const statusMap = {
          0: '审批通过',
					1: '驳回',
					2: '提交',
					3: '验票',
					4: '验收'
      }
      this.getById('/spang-safety/approve-history/approve-his', this.ticketId).then(({ data, code }) => {
        if (code === 200) {
          this.historyDatas = data.map(item => (
            {
              userTypeName: item.userTypeName,
              suggest: item.suggest,
              submitter: item.userName,
              operateName: statusMap[item.operateStatus],
              submitTime: item.submitTime,
              signature: item.signatureUrl ? this.BASE_URL + '/spang-safety/file' + item.signatureUrl : '',
              operateStatus: item.operateStatus
            }
          ))
        }
      })
    },
    getTeamCheck () {
      this.getById('/spang-safety/workticket/hotwork/getTeamCheckVO', this.ticketId).then(({data, code}) => {
        this.signData = [
          {
            title: '验票',
            time: data.signDate,
            sign: data.signatureURL,
            files: data.files
          }
        ]
      })
    }
  },
  created () {
    this.getHistory()
    this.getTeamCheck()
  }
}
</script>

<style scoped lang="less">

  .ant-list-item {
    width: 100%;
    .list-content {
      width: 100%;
      display: flex;
      justify-content: space-between;
      .list-content-item {
        width: 15%;
      }
    }
  }
</style>
