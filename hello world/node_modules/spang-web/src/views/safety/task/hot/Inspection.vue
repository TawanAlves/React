<template>
  <a-card style="margin: 15px;">
    <a-tabs
      default-active-key="1"
      tab-position="left"
      @change="handleTabChange"
    >
      <a-tab-pane key="1" tab="最终验收">
        <div class="measure-title">整体验收时间:{{ finalData.finalTime }}</div>
        <a-divider/>
        <horizontal-list :list-data="finalData"></horizontal-list>
      </a-tab-pane>
      <a-tab-pane key="2" tab="过程验收">
        <template v-for="item in processHistoryData">
          <div class="measure-title" :key="item.id">过程验收:{{ item.gmtModified }}</div>
          <a-divider :key="item.id"/>
          <horizontal-list :list-data="item":key="item.id" style="margin-bottom: 10px;"></horizontal-list>
        </template>

      </a-tab-pane>
      <a-tab-pane key="3" tab="过程历史">
        <template v-for="item in processHistoryData">
          <div class="measure-title" :key="item.id">过程验收:{{ item.gmtModified }}</div>
          <a-divider :key="item.id"/>
          <horizontal-list :list-data="item":key="item.id" style="margin-bottom: 10px;"></horizontal-list>
        </template>
        <template v-for="item in finalHistoryData">
          <div class="measure-title" :key="item.id">最终验收:{{ item.gmtModified }}</div>
          <a-divider :key="item.id"/>
          <horizontal-list :list-data="item":key="item.id" style="margin-bottom: 10px;"></horizontal-list>
        </template>
      </a-tab-pane>
    </a-tabs>
  </a-card>
</template>

<script>
import HorizontalList from '../component/HorizontalList'
export default {
  name: 'Inspection',
  components: { HorizontalList },
  props: {
    ticketId: {
      type: String,
      required: true
    }
  },
  data () {
    return {
      finalHistoryData: [],
      processHistoryData: [],
      finalData: {
        title1: '作业单位负责人',
        title2: '所在单位负责人'
      }
    }
  },
  methods: {
    getHistory () {
      const params = {
        ticketId: this.ticketId
      }
      this.getList('/spang-safety/accept/history', params).then(({ data, code }) => {
        data.map(item => {
          item.title1 = '作业单位负责人'
          item.time1 = item.safeWorkTeachDate
          item.sign1 = item.safeWorkTeachPicUrl
          item.files1 = item.safeWorkTeachFiles
          item.title2 = '所在单位负责人'
          item.time2 = item.safeInTeachDate
          item.sign2 = item.safeInTeachPicUrl
          item.files2 = item.safeInTeachFiles
        })
        this.finalHistoryData = data.filter(item => item.acceptType === 0)
        this.processHistoryData = data.filter(item => item.acceptType === 1)
        if (this.finalHistoryData.length > 0) {
          this.finalData = this.finalHistoryData[0]
        }
      })
    }
  },
  created () {
    this.getHistory()
  }
}
</script>

<style scoped>

</style>
