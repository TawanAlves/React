<template>
  <a-card title="审核记录" style="margin: 15px;">
    <approve-list :history-datas="historyDatas"></approve-list>
    <a-divider />
    <div class="measure-title">安全措施落实</div>
    <a-divider />
    <signature-list :list-data="detailData"></signature-list>
  </a-card>
</template>

<script>
import ApproveList from '../component/ApproveList'
import SignatureList from '../component/SignatureList'
export default {
  name: 'Approval',
  components: { ApproveList, SignatureList },
  props: {
    ticketId: {
      type: String,
      default: '',
      required: true
    }
  },
  data () {
    return {
      historyDatas: [],
      detailData: [
        {
          title: '作业单位安全教育人',
          time: null,
          sign: null,
        }, {
          title: '所在单位安全教育人',
          time: null,
          sign: null,
        }
      ]
    }
  },
  methods: {
    getHistory () {
      const statusMap = { 0: '审批通过', 1: '驳回',	2: '提交' }
      this.getById('/spang-safety/approve-history/approve-his', this.ticketId).then(({ data, code }) => {
        if (code === 200) {
          this.historyDatas = data.map(item => (
            {
              userTypeName: item.userTypeName,
              suggest: item.suggest,
              submitter: item.userName,
              operateName: statusMap[item.operateStatus],
              submitTime: item.submitTime,
              signature: item.signatureUrl ? this.BASE_URL + '/spang-safety/file' + item.signatureUrl : '',
              operateStatus: item.operateStatus
            }
          ))
        }
      })
    },
    getDetail () {
      this.getById('/spang-safety/affirm', this.ticketId).then(({ data, success }) => {
					if (success) {
						data.forEach(item => {
							if (item.userType === 44) {
								this.detailData[0].sign = item.signatureUrl
								this.detailData[0].time = item.signTime
							} else if (item.userType === 45) {
								this.detailData[1].sign = item.signatureUrl
								this.detailData[1].time = item.signTime
							}
						})
					}
				})
    }
  },
  created () {
    this.getHistory()
    this.getDetail()
  }
}
</script>

<style scoped lang="less">

  .ant-list-item {
    width: 100%;
    .list-content {
      width: 100%;
      display: flex;
      justify-content: space-between;
      .list-content-item {
        width: 15%;
      }
    }
  }
</style>
