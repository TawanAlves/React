<template>
  <a-card title="审核记录" style="margin: 15px;">
    <approve-list :history-datas="historyDatas"></approve-list>
    <a-divider />
    <div class="measure-title">安全措施落实</div>
    <a-divider />
    <signature-list :list-data="ticketCheckingList"></signature-list>
  </a-card>
</template>

<script>
import { getApprovalHistory } from '@/api/electric-work'
import ApproveList from '../component/ApproveList'
import SignatureList from '../component/SignatureList'
export default {
  name: 'Approval',
  components: { ApproveList, SignatureList },
  props: {
    ticketId: {
      type: String,
      default: '',
      required: true
    }
  },
  data () {
    return {
      historyDatas: [],
      ticketCheckingList:[],
    }
  },
  methods: {
    getHistory () {
      const statusMap = { 0: '审批通过', 1: '驳回',	2: '提交' }
      this.getById('/spang-safety/approve-history/approve-his', this.ticketId).then(({ data, code }) => {
        if (code === 200) {
          this.historyDatas = data.map(item => ({
              userTypeName: item.userTypeName,
              suggest: item.suggest,
              submitter: item.userName,
              operateName: statusMap[item.operateStatus],
              submitTime: item.submitTime,
              signature: item.signatureUrl ? this.BASE_URL + '/spang-safety/file' + item.signatureUrl : '',
              operateStatus: item.operateStatus
            }))
        }
      })
      this.getById('/spang-safety/affirm',this.ticketId).then(({data,code})=>{
        if(code === 200){
          console.log(data)
          data.forEach(d=>{
            if(d.userType === 44){
              d.title = '作业负责人验票';
              d.sign = d.signatureUrl ? d.signatureUrl : '';
              d.time = d.signTime;
              this.ticketCheckingList.push(d);
            }
          })
          console.log(this.ticketCheckingList)
        }
      })
    }
  },
  created () {
    this.getHistory()
  }
}
</script>

<style scoped lang="less">

  .ant-list-item {
    width: 100%;
    .list-content {
      width: 100%;
      display: flex;
      justify-content: space-between;
      .list-content-item {
        width: 15%;
      }
    }
  }
</style>
