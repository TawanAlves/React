<template>
  <a-card style="margin: 15px;">
    <a-tabs
      default-active-key="1"
      tab-position="left"
      @change="callback"
    >
      <a-tab-pane key="1" tab="最终验收">
        <div class="measure-title">整体验收时间:{{ finalData.finalTime }}</div>
        <a-divider/>
        <horizontal-list :list-data="finalData"></horizontal-list>
      </a-tab-pane>
      <a-tab-pane key="2" tab="延期">
        <a-form class="ant-advanced-search-form">
          <a-form-item label="本次检修计划延期至">
              <a-input :value="delayData.date" disabled/>
            </a-form-item>
          <a-form-item label="延期原因">
              <a-input :value="delayData.content" disabled/>
            </a-form-item>
        </a-form>
        <horizontal-list :list-data="delayData"></horizontal-list>
      </a-tab-pane>
      <a-tab-pane key="3" tab="过程历史">
        <template v-for="item in delayData">
          <horizontal-list :list-data="item"></horizontal-list>
          <div>延期至: {{item.date}}</div>
          <a-divider />
        </template>
        <template v-for="item in finalHistoryData">
          <div class="measure-title" :key="item.id">最终验收</div>
          <a-divider :key="item.id"/>
          <horizontal-list :list-data="item" :key="item.id" style="margin-bottom: 10px;"></horizontal-list>
        </template>
      </a-tab-pane>
    </a-tabs>
  </a-card>
</template>

<script>
import { getInspectionHistory } from '@/api/hot-work'
import HorizontalList from '../component/HorizontalList'
export default {
  name: 'Inspection',
  components: { HorizontalList },
  props: {
    ticketId: {
      type: String,
      required: true
    }
  },
  data () {
    return {
      finalHistoryData: [],
      finalData: [],
      delayData: [],
    }
  },
  methods: {
    callback(key){
      if(key == 1){
        this.getHistory(0);
      }else if(key == 2){
        this.getHistory(2);
      }else if(key == 3){
        this.finalAcceptFun();
      }
    },
    getHistory (type) {
      const params = {
        ticketId: this.ticketId,
        acceptType: type
      }
      this.getList('/spang-safety/accept', params).then(({ data, code }) => {
        this.finalData = data;
        if(type === 0){
          this.finalData = Object.assign({}, this.finalData, {
            title1: '作业负责人-检修车间',
            person1: data.safeWorkTeachName,
            time1: data.safeWorkTeachDate,
            sign1: data.safeWorkTeachPicUrl,
            files1: data.safeWorkTeachFiles,
            title2: '工作负责人-生产车间',
            person2: data.safeInTeachName,
            time2: data.safeInTeachDate,
            sign2: data.safeInTeachPicUrl,
            files2: data.safeInTeachFiles,
            acceptTime: data.finalTime
          })
        }else if(type === 2){
          this.delayData = Object.assign({}, this.finalData, {
            date: data.delayTime,
            content: data.type,
            title1: '作业负责人-检修车间',
            person1: data.safeWorkTeachName,
            time1: data.safeWorkTeachDate,
            sign1: data.safeWorkTeachPicUrl,
            files1: data.safeWorkTeachFiles,
            title2: '工作负责人-生产车间',
            person2: data.safeInTeachName,
            time2: data.safeInTeachDate,
            sign2: data.safeInTeachPicUrl,
            files2: data.safeInTeachFiles,
            acceptTime: data.finalTime
          })
        }

        // this.workTypeOptions.forEach(item => {
        //   const types = data.type.split(',')
        //   item.checked = types.includes(item.value)
        // })
      })
    },
    finalAcceptFun(){
      let _this = this;
      this.getList('/spang-safety/accept/history', {'ticketId': this.ticketId}).then(({ data, code }) => {
        this.finalHistoryData = [];
        this.delayData = [];
        if(code === 200){
          data.forEach(d=>{
            d.date = d.delayTime;
            d.content = d.type;
            d.title1 = '作业负责人-检修车间';
            d.person1 = d.safeWorkTeachName;
            d.time1 = d.safeWorkTeachDate;
            d.sign1 = d.safeWorkTeachPicUrl;
            d.files1 = d.safeWorkTeachFiles;
            d.title2 = '工作负责人-生产车间';
            d.person2 = d.safeInTeachName;
            d.time2 = d.safeInTeachDate;
            d.sign2 = d.safeInTeachPicUrl;
            d.files2 = d.safeInTeachFiles;
            d.acceptTime = d.finalTime;
            if(d.acceptType === 2){
              this.delayData.push(d)
            }else{
              this.finalHistoryData.push(d)
            }
          })
        }
      })
    }
  },
  created () {
    this.getHistory(0)
  }
}
</script>

<style scoped>

</style>
