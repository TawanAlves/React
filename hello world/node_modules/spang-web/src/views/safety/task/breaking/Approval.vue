<template>
  <a-card title="审核记录" style="margin: 15px;">
    <approve-list :history-datas="historyDatas"></approve-list>
    <div class="measure-title">安全措施落实</div>
    <a-divider />
    <horizontal-list :list-data="signData"></horizontal-list>
  </a-card>
</template>

<script>
import ApproveList from '../component/ApproveList'
import HorizontalList from '../component/HorizontalList'
export default {
  name: 'Approval',
  components: { ApproveList, HorizontalList },
  props: {
    ticketId: {
      type: String,
      default: '',
      required: true
    }
  },
  data () {
    return {
      signData: {
        title1: '作业单位安全教育人',
        time1: null,
        sign1: null,
        title2: '所在单位安全教育人',
        time2: null,
        sign2: null
      },
      historyDatas: []
    }
  },
  methods: {
    getHistory () {
      const statusMap = { 0: '审批通过', 1: '驳回',	2: '提交' }
      this.getById('/spang-safety/approve-history/approve-his', this.ticketId).then(({ data, code }) => {
        if (code === 200) {
          this.historyDatas = data.map(item => (
            {
              userTypeName: item.userTypeName,
              suggest: item.suggest,
              submitter: item.userName,
              operateName: statusMap[item.operateStatus],
              submitTime: item.submitTime,
              signature: item.signatureUrl ? this.BASE_URL + '/spang-safety/file' + item.signatureUrl : '',
              operateStatus: item.operateStatus
            }
          ))
        }
      })
    },
    getAffirm () {
      this.getById('/spang-safety/affirm', this.ticketId).then(({ data, success }) => {
					if (success) {
						data.forEach(item => {
							if (item.userType === 44) {
								this.signData.sign1 = item.signatureUrl
								this.signData.time1 = item.signTime
							} else if (item.userType === 45) {
								this.signData.sign2 = item.signatureUrl
								this.signData.time2 = item.signTime
							}
						})
					}
				})
    }
  },
  created () {
    this.getHistory()
    this.getAffirm()
  }
}
</script>

<style scoped lang="less">

  .ant-list-item {
    width: 100%;
    .list-content {
      width: 100%;
      display: flex;
      justify-content: space-between;
      .list-content-item {
        width: 15%;
      }
    }
  }
</style>
