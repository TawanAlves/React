<template>
  <div>
    <a-card title="基本信息" style="margin: 15px;">
      <a-form class="ant-advanced-search-form">
        <a-row :gutter="24">
          <a-col :span="10" :offset="1">
            <a-form-item label="作业证编号">
              <a-input :value="formData.code" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="吊装地点">
              <a-input :value="formData.workAddress" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="施工单位">
              <a-input :value="formData.constructionUnitType === 0 ? '内部单位' : '外来施工单位'" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="计划作业起止时间">
              <a-input :value="formData.planStartTime + '至' + formData.planEndTime" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="申请单位">
              <a-input :value="formData.applicantUnitName" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="实际作业起止时间">
              <a-input :value="actualTime" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="申请人">
              <a-input :value="formData.applicantName" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="是否附吊装方案">
              <a-input :value="formData.haveScheme === 0 ? '是': '否'" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="吊装指挥人">
              <a-row :gutter="24">
                <a-col :span="12">
                  <a-input :value="formData.field4" disabled/>
                </a-col>
                <a-col :span="12">
                  <a-input :value="formData.field3" disabled/>
                </a-col>
              </a-row>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="作业单位">
              <department-select v-model="formData.workUnitName" disabled></department-select>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="作业分级">
              <a-input :value="formData.workLevel" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="施工方安全负责人">
              <a-input :value="formData.field6" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="项目名称">
              <a-input :value="formData.field2" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="施工方项目总负责人">
              <a-input :value="formData.field7" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="吊装内容">
              <a-input :value="formData.workContent" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1" v-if="formData.workLevel === 3">
            <a-form-item label="施工方机械指挥人">
              <a-input :value="formData.field8" disabled />
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="起吊重物质量(kg)">
              <a-input :value="formData.field1" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1"  v-if="formData.workLevel === 3">
            <a-form-item label="现场监护人">
              <a-input :value="formData.localeGuardianName" disabled/>
            </a-form-item>
          </a-col>
          <a-col :span="10" :offset="1">
            <a-form-item label="吊装工具名称">
              <a-input :value="formData.field5" disabled/>
            </a-form-item>
          </a-col>
        </a-row>
      </a-form>
      <a-divider style="margin: 0;"/>
      <a-row :gutter="24">
        <a-col :span="24">
          <div style="margin: 10px 0;">其中机械操作人员:</div>
        </a-col>
        <a-table
          ref="table"
          size="default"
          :rowKey="record => record.id"
          :columns="columns"
          :dataSource="formData.workTicketRelatedUserList"
          :alert="false"
          :scroll="{ y: 350 }"
          :pagination="false"
        >
        </a-table>
      </a-row>
    </a-card>
    <person-history :history-datas="historyList" />
  </div>
</template>

<script>
import DepartmentSelect from '@/views/safety/components/DepartmentSelect'
import { getDetail, getPersonHistory } from '@/api/hoisting-work'
import { mapGetters } from 'vuex'
import PersonHistory from '../component/PersonHistory'

export default {
  name: 'BasicInfo',
  components: { PersonHistory, DepartmentSelect },
  props: {
    ticketId: {
      type: String,
      default: '',
      required: true
    }
  },
  data () {
    return {
      formData: {},
      historyList: [],
      columns: [
        {
          title: '姓名',
          dataIndex: 'userName',
          align: 'center',
          width: '150px'
        },
        {
          title: '作业编号',
          dataIndex: 'certificateCode',
          align: 'left'
        }
      ]
    }
  },
  computed: {
    ...mapGetters(['userInfo']),
    actualTime () {
      if (this.formData.actualStartTime && this.formData.actualEndTime) {
        return this.formData.actualStartTime + '至' + this.formData.actualEndTime
      }
      return ''
    }
  },
  methods: {
    loadDetailInfo () {
      this.getByIdRestful('/spang-safety/basic-information', this.ticketId).then(({ data, code }) => {
        if (code === 200) {
          this.code = data.code
          this.formData = data
        }
      })
    },
    getPersonList () {
      this.getById('/spang-safety/user-history', this.ticketId).then(({ data, code }) => {
        if (code === 200) {
          this.historyList = data
        }
      })
    }
  },
  created () {
    this.loadDetailInfo()
    this.getPersonList()
  }
}
</script>

<style scoped lang="less">

/deep/ .ant-advanced-search-form .ant-form-item {
  display: flex;
}
/deep/ .ant-advanced-search-form .ant-form-item-label {
  width: 130px;
}

/deep/ .ant-advanced-search-form .ant-form-item-control-wrapper {
  flex: 1;
}
/deep/ .ant-table {
  height: auto;
}
.flex-input-button {
  display: flex;
  justify-content: space-between;
}
</style>
