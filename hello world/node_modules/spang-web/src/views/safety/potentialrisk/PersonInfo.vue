<template>
  <div>
    <a-select
      show-search
      v-model="personId"
      style="width: 200px"
      :default-active-first-option="false"
      :show-arrow="false"
      :filter-option="false"
      :not-found-content="null"
      @search="handleSearch"
      @change="handleChange"
    >
      <a-select-option v-for="d in data" :key="d.id">
        {{ d.name }}
      </a-select-option>
    </a-select>
    <a-button type="link" @click="onSearch"><a-icon type="search"></a-icon></a-button>
    <a-modal
      title="人员信息"
      :width="1000"
      :visible="visible"
      :confirmLoading="loading"
      @ok="handleOk"
      @cancel="handleCancel"
      :keyboard="false"
      :maskClosable="false"
      ok-text="确定"
      cancel-text="取消">
      <a-form layout="inline" style="margin-bottom: 18px">
        <a-row :gutter="24">
          <a-col :span="7">
            <a-form-item label="关键字">
              <a-input/>
            </a-form-item>
          </a-col>
          <a-col :span="7">
            <a-form-item label="部门">
              <a-input/>
            </a-form-item>
          </a-col>
          <a-col :span="7">
            <a-form-item label="角色">
              <a-input/>
            </a-form-item>
          </a-col>
          <a-col :span="2">
            <a-button type="primary" style="margin-top: 3px">搜索</a-button>
          </a-col>
        </a-row>
      </a-form>
      <s-table
        ref="personnelTable"
        size="middle"
        :rowKey="record => record.id"
        type="radio"
        :columns="columns"
        :data="loadData"
        :alert="false"
        :rowSelection="rowSelection"
        showPagination="auto"
      />
    </a-modal>
    {{ personId }}
  </div>
</template>

<script>
import { getPersonnelUser } from '@/api/safety'
import { personnelColumns } from '@/views/safety/table'
import { STable } from '@/components'

export default {
  name: 'PersonInfo',
  model: {
    prop: 'personId',
    event: 'handleOk'
  },
  components: {
    STable
  },
  inject: {
    modal: {
      type: Object,
      default: null
    }
  },
  data () {
    return {
      visible: false,
      personId: '',
      queryParam: {},
      data: [],
      loadData: parameter => {
        const requestParameters = { current: parameter.pageNo, size: parameter.pageSize }
        Object.assign(requestParameters, this.queryParam)
        return getPersonnelUser(requestParameters).then(res => {
          const data = {}
          data.totalCount = res.data.total
          data.totalPage = res.data.pages
          data.pageNo = res.data.current
          data.pageSize = res.data.size
          data.data = res.data.records
          return data
        })
      },
      selectedRowKeys: [],
      selectedRows: []
    }
  },
  computed: {
    columns: () => personnelColumns.slice(0, -1),
    rowSelection () {
      return {
        selectedRowKeys: this.selectedRowKeys,
        onChange: this.onSelectChange,
        type: 'radio',
        columnWidth: '30px'
      }
    }
  },
  // mounted () {
  //   this.personId = this.modal.modalData.informantName
  // },
  methods: {
    onSelectChange (selectedRowKeys, selectedRows) {
      this.selectedRowKeys = selectedRowKeys
      this.selectedRows = selectedRows
    },
    onSearch () {
      this.visible = true
    },
    handleOk () {
      this.data = this.selectedRows
      this.personId = this.selectedRows[0].id
      this.visible = false
      this.$emit('click', { id: this.personId })
    },
    handleCancel () {
      this.visible = false
    },
    handleSearch (value) {
    },
    handleChange () {
      console.log('1111111111111')
    }
  }
}
</script>
