<template>
  <page-container :title="false">
    <a-card :bordered="false" style="margin: 15px" :body-style="{'padding-bottom': '0px'}">
      <div class="table-page-search-wrapper">
        <a-form layout="inline">
          <a-row :gutter="24">
            <a-col :lg="6" :md="8" :sm="12" :xs="24" >
              <a-form-item label="单位">
                <a-tree-select
                  v-model="queryParam.deptId"
                  show-search
                  style="width: 100%"
                  :dropdown-style="{ maxHeight: '400px', overflow: 'auto' }"
                  :tree-data="signOrgNameOptions"
                  placeholder="单位"
                  allow-clear
                  tree-default-expand-all
                />
              </a-form-item>
            </a-col>
            <a-col :lg="6" :md="8" :sm="12" :xs="24" >
              <a-form-item label="状态">
                <a-select
                  show-search
                  v-model="queryParam.status"
                  placeholder="状态"
                  style="width: 100%"
                >
                  <a-select-option
                    v-for="d in trainWayNameOptions"
                    :key="d.dictKey"
                  >{{ d.dictValue }}</a-select-option>
                </a-select>
              </a-form-item>
            </a-col>
            <a-col :lg="6" :md="8" :sm="12" :xs="24" >
              <a-form-item label="三违行为类型">
                <a-select
                  show-search
                  v-model="queryParam.type"
                  placeholder="三违行为类型"
                  style="width: 100%"
                >
                  <a-select-option v-for="d in templateTypeNameOptions" :key="d.dictKey">
                    {{
                    d.dictValue
                    }}
                  </a-select-option>
                </a-select>
              </a-form-item>
            </a-col>
            <a-col :lg="6" :md="24" :sm="12" :xs="24"  class="table-page-search-submitButtons">
              <a-space>
                <a-button type="primary" @click="$refs.table.refresh(true)">查询</a-button>
                <a-button type="second" @click="searchReset">重置</a-button>
              </a-space>
            </a-col>
          </a-row>
        </a-form>
      </div>
    </a-card>
    <a-card
      :bordered="false"
      style="margin: 15px"
      :headStyle="{ border: 'none', paddingBottom: 0 }"
      :bodyStyle="{ paddingBottom: 0 }"
      class="table-card"
    >
      <template #title>
        <div class="text-right">
          <a-button type="primary" icon="plus" @click="addRecord" style="float: right">新建</a-button>
        </div>
      </template>
      <s-table
        ref="table"
        size="default"
        :rowKey="(record) => record.id"
        :columns="columns"
        :data="loadData"
        :alert="false"
        showPagination="true"
        :scroll="{ y: `calc(100vh - 434px)`, x: 1490 }"
      >
        <!-- 序号 -->
        <span
          slot="number"
          slot-scope="text, record, index"
        >{{ pagination.pageSize * (pagination.current - 1) + index + 1 }}</span>
        <!-- 序号 end -->
        <template slot="status" slot-scope="text, record">
          <a-tag :color="record.status | colorFilter" style="margin-right: 0 !important">
            {{
            record.status | textFilter
            }}
          </a-tag>
        </template>
        <span slot="files" slot-scope="text, record">
          <template>
            <a @click="viewFiles(record)">查看</a>
          </template>
        </span>
        <span slot="action" slot-scope="text, record">
          <template>
            <a @click="viewRecord(record)">查看</a>
            <a-divider
              type="vertical"
              v-if="record.status === 0 &&  userInfo.id === record.gmtCreateId "
            />
            <a
              @click="editRecord(record)"
              v-if="record.status === 0 &&  userInfo.id === record.gmtCreateId "
            >编辑</a>
            <a-divider
              type="vertical"
              v-if="record.status === 0 && userInfo.id === record.gmtCreateId"
            />
            <a
              @click="publishRecord(record,1)"
              v-if="record.status === 0 && userInfo.id === record.gmtCreateId"
            >提交</a>
            <a-divider
              type="vertical"
              v-if="record.status === 0 && userInfo.id === record.gmtCreateId"
            />
            <a
              @click="removeRecord(record)"
              v-if="record.status === 0 && userInfo.id === record.gmtCreateId"
            >删除</a>
          </template>
        </span>
      </s-table>
      <a-modal
        :title="commonTitle"
        :visible="commonVisible"
        :confirm-loading="confirmLoading"
        :maskClosable="false"
        width="900px"
        height="600px"
        :ok-button-props="{ props: { disabled: commonDisabled } }"
        @ok="modalOk()"
        @cancel="handleCancelModal"
        :keyboard="false"
      >
        <div v-if="filesList" class="filesList">
          <div v-if="imgList.length>0">
            <!-- <ul v-for="item in imgList" :key="item.id">
              <li>
                <img :src="item.filePath" alt />
              </li>
            </ul>-->
            <vue-viewer multiple list-ul-class="image-list" :thumb="imgList" :full="imgList"></vue-viewer>
          </div>
          <div v-else style="text-align:center;">暂无数据</div>
        </div>
        <a-form-model
          ref="ruleForm"
          :model="commonData"
          :rules="rules"
          :label-col="labelCol"
          :wrapper-col="wrapperCol"
          v-else
        >
          <div class="steps" v-if="commonDisabled">
            <a-steps :current="commonData.status" progress-dot>
              <a-step>
                <template slot="title">登记</template>
                <span slot="title">【{{commonData.registrantName}}】</span>
                <span slot="description">{{commonData.registerTime}}</span>
              </a-step>
              <a-step>
                <template slot="title">提交</template>
                <span slot="title">【{{commonData.submitterName}}】</span>
                <span slot="description">{{commonData.submitTime}}</span>
              </a-step>
              <a-step>
                <template slot="title">处理</template>
                <span slot="title">【{{commonData.processorName}}】</span>
                <span slot="description">{{commonData.processTime}}</span>
              </a-step>
            </a-steps>
            <div class="contentTitle">三违登记信息</div>
          </div>
          <div>
            <a-row :gutter="24">
              <a-col :span="24">
                <a-form-model-item ref="violationType" label="三违行为类型" prop="violationType">
                  <a-select
                    :disabled="commonDisabled"
                    show-search
                    v-model="commonData.violationType"
                    placeholder="三违行为类型"
                    style="width: 100%"
                  >
                    <a-select-option v-for="d in templateTypeNameOptions" :key="d.dictKey">
                      {{
                      d.dictValue
                      }}
                    </a-select-option>
                  </a-select>
                </a-form-model-item>
              </a-col>
              <a-col :span="24">
                <a-form-model-item label="三违描述" prop="description">
                  <a-input
                    placeholder="三违描述"
                    :disabled="commonDisabled"
                    v-model="commonData.description"
                    type="textarea"
                    :max-length="256"
                  />
                </a-form-model-item>
              </a-col>
              <a-col :span="24">
                <a-form-model-item ref="violationDeptId" label="违规人部门" prop="violationDeptId">
                  <a-tree-select
                    :disabled="commonDisabled"
                    v-model="commonData.violationDeptId"
                    show-search
                    style="width: 100%"
                    :dropdown-style="{ maxHeight: '400px', overflow: 'auto' }"
                    :tree-data="signOrgNameOptions"
                    placeholder="违规人部门"
                    allow-clear
                    tree-default-expand-all
                  />
                </a-form-model-item>
              </a-col>
              <a-col :span="12" style="padding-left: 15px">
                <a-form-model-item
                  ref="violationPersonName"
                  label="违规人姓名"
                  prop="violationPersonName"
                  :label-col="{ span: 6 }"
                  :wrapper-col="{ span: 18 }"
                >
                  <!-- <a-input
                    :disabled="commonDisabled"
                    v-model="commonData.violationPersonName"
                    @blur="
                      () => {
                        $refs.violationPersonName.onFieldBlur()
                      }
                    "
                  />-->
                  <a-select
                    :disabled="commonDisabled"
                    show-search
                    v-model="commonData.violationPersonName"
                    placeholder="违规人姓名"
                    style="width: 100%"
                    @change="changePeople"
                  >
                    <a-select-option
                      v-for="d in processorNameOptions"
                      :key="d.realName"
                    >{{ d.realName }}</a-select-option>
                  </a-select>
                </a-form-model-item>
              </a-col>
              <a-col :span="12">
                <a-form-model-item
                  ref="violationTime"
                  label="违规发生时间"
                  prop="violationTime"
                  :label-col="{ span: 6 }"
                  :wrapper-col="{ span: 18 }"
                >
                  <a-date-picker
                    show-time
                    placeholder="请选择违规发生时间"
                    :disabled="commonDisabled"
                    v-model="commonData.violationTime"
                    format="YYYY-MM-DD HH:mm:ss"
                    @change="onChange"
                    @ok="onOk"
                    style="width: 100%"
                  />
                </a-form-model-item>
              </a-col>
              <a-col :span="24">
                <a-form-model-item ref="violationAddress" label="违规发生地" prop="violationAddress">
                  <a-input
                    placeholder="请选择违规发生地"
                    :disabled="commonDisabled"
                    v-model="commonData.violationAddress"
                    @blur="
                      () => {
                        $refs.violationAddress.onFieldBlur()
                      }
                    "
                  />
                </a-form-model-item>
              </a-col>
              <a-col :span="24">
                <a-form-model-item ref="postName" label="三违照片" prop="postName">
                  <a-upload
                    :class="commonDisabled ? 'imgList' : ''"
                    action="/api/spang-safety/fileserver/fileUpload"
                    list-type="picture-card"
                    :file-list="fileList"
                    @preview="handlePreview"
                    :before-upload="beforeUpload"
                    @change="handleChange"
                  >
                    <div v-if="!commonDisabled">
                      <a-icon type="plus" />
                      <div class="ant-upload-text">上传照片</div>
                    </div>
                  </a-upload>
                  <a-modal
                    :visible="previewVisible"
                    :disabled="commonDisabled"
                    :footer="null"
                    @cancel="handleCancelImg"
                    width="80%"
                  >
                    <img alt style="width: 100%" :src="previewImage" />
                  </a-modal>
                </a-form-model-item>
              </a-col>
              <a-col :span="12" :gutter="24">
                <a-form-model-item
                  ref="processorName"
                  label="三违处理人员"
                  prop="processorName"
                  :label-col="{ span: 6 }"
                  :wrapper-col="{ span: 18 }"
                >
                  <a-select
                    :disabled="commonDisabled"
                    show-search
                    v-model="commonData.processorName"
                    placeholder="三违处理人员"
                    style="width: 100%"
                    @change="changePeople"
                  >
                    <a-select-option
                      v-for="d in processorNameOptions"
                      :key="d.realName"
                    >{{ d.realName }}</a-select-option>
                  </a-select>
                </a-form-model-item>
              </a-col>
            </a-row>
          </div>
          <div v-if="commonDisabled">
            <div class="contentTitle">处理信息</div>
            <div>
              <a-row :gutter="24">
                <a-col :span="12">
                  <a-form-model-item
                    ref="result"
                    label="处理结果"
                    prop="result"
                    v-if="publishData.threeViolateVO.statusName === '已处理'"
                    :label-col="{ span: 6 }"
                    :wrapper-col="{ span: 18 }"
                  >
                    <a-input
                      :disabled="commonDisabled"
                      v-model="publishData.threeViolateVO.statusName"
                    />
                  </a-form-model-item>
                </a-col>
                <a-col :span="12">
                  <a-form-model-item
                    ref="type"
                    label="处理方式"
                    prop="type"
                    v-if="publishData.threeViolateVO.statusName === '已处理'"
                    :label-col="{ span: 6 }"
                    :wrapper-col="{ span: 18 }"
                  >
                    <!-- <a-input
                      :disabled="commonDisabled"
                      v-model="publishData.type"
                      @blur="
                      () => {
                        $refs.type.onFieldBlur()
                      }
                    "
                    />-->
                    <a-row :gutter="4">
                      <a-col :span="this.publishData.type === 1?14:24">
                        <a-select
                          style="width:100%"
                          :disabled="commonDisabled"
                          v-model="publishData.type"
                          @change="typeChange"
                        >
                          <a-select-option :value="0">警告</a-select-option>
                          <a-select-option :value="1">处罚</a-select-option>
                        </a-select>
                      </a-col>
                      <a-col :span="10">
                        <a-input
                          v-if="this.publishData.type === 1"
                          style="width: 100%"
                          :disabled="commonDisabled"
                          v-model="publishData.penaltyAmount"
                          suffix="元"
                          @blur="
                          () => {
                            $refs.penaltyAmount.onFieldBlur()
                          }
                        "
                        />
                        <!--                        <span-->
                        <!--                          v-if="this.publishData.type === 1"-->
                        <!--                          style="width:5%;display:inline-block;padding-left:2%;"-->
                        <!--                        >元</span>-->
                      </a-col>
                    </a-row>
                  </a-form-model-item>
                </a-col>
                <a-col :span="12">
                  <a-form-model-item
                    ref="processorName"
                    label="三违处理人"
                    prop="processorName"
                    :label-col="{ span: 6 }"
                    :wrapper-col="{ span: 18 }"
                  >
                    <a-input
                      :disabled="commonDisabled"
                      v-model="commonData.processorName"
                      @blur="
                      () => {
                        $refs.processorName.onFieldBlur()
                      }
                    "
                    />
                  </a-form-model-item>
                </a-col>
                <a-col :span="12">
                  <a-form-model-item
                    ref="processTime"
                    label="处理时间"
                    prop="processTime"
                    :label-col="{ span: 6 }"
                    :wrapper-col="{ span: 18 }"
                  >
                    <a-input
                      :disabled="commonDisabled"
                      v-model="commonData.processTime"
                      @blur="
                      () => {
                        $refs.processTime.onFieldBlur()
                      }
                    "
                    />
                  </a-form-model-item>
                </a-col>
                <a-col :span="12">
                  <a-form-model-item
                    ref="processGist"
                    label="处理依据"
                    prop="processGist"
                    :label-col="{ span: 6 }"
                    :wrapper-col="{ span: 18 }"
                  >
                    <a-input
                      :disabled="commonDisabled"
                      v-model="publishData.processGist"
                      type="textarea"
                    />
                  </a-form-model-item>
                </a-col>
              </a-row>
            </div>
          </div>
        </a-form-model>
      </a-modal>
    </a-card>
  </page-container>
</template>
<script>
import { STable } from '@/components'
import { registryColumns } from '@/views/safety/table'
import ApiURLs from '@/api/urls'
import { mapGetters } from 'vuex'
import { getStore } from '@/utils/store'
import { getDict } from '@/api/system'
import { getPersonnelTree } from '@/api/safety'
import PersonSelectModal from '@/views/safety/task/component/PersonSelectModal'
import { getUsers } from '@/api/system'
function getBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    reader.readAsDataURL(file)
    reader.onload = () => resolve(reader.result)
    reader.onerror = error => reject(error)
  })
}

export default {
  name: 'registry',
  components: {
    STable,
    PersonSelectModal
  },
  data() {
    return {
      pagination: {
        current: 1,
        pageSize: 10,
        showSizeChanger: true
      },
      peopleVisible: false,
      confirmLoadingPeople: false,
      autoExpandParent: true,
      publishData: {},

      templateTypeNameOptions: [],
      trainWayNameOptions: [
        {
          dictKey: 0,
          id: '',
          dictValue: '未提交'
        },
        {
          dictKey: 1,
          id: '',
          dictValue: '已提交'
        },
        {
          dictKey: 2,
          id: '',
          dictValue: '已处理'
        },
        {
          dictKey: 3,
          id: '',
          dictValue: '关闭'
        }
      ],

      labelCol: { span: 3 },
      wrapperCol: { span: 21 },
      confirmLoading: false,
      commonTitle: '',
      commonVisible: false,
      processorNameOptions: [],
      commonData: {},
      commonDisabled: false,
      queryParam: {},
      selectedRowKeys: [],
      selectedRows: [],
      fileList: [],
      previewVisible: false,
      previewImage: '',
      filesList: false,
      imgList: [],

      loadData: parameter => {
        const requestParameters = { current: parameter.pageNo, size: parameter.pageSize }
        Object.assign(requestParameters, this.queryParam)
        return this.getList(ApiURLs.registryList, requestParameters).then(res => {
          const data = {}
          data.totalCount = res.data.total
          data.totalPage = res.data.pages
          data.pageNo = res.data.current
          data.pageSize = res.data.size
          data.data = res.data.records
          this.pagination = {
            current: data.pageNo,
            pageSize: data.pageSize,
            showSizeChanger: true
          }
          return data
        })
      },
      userInfo: getStore({ name: 'info' }),
      newDate: '',
      versionData: '',
      rules: {
        violationPersonName: [{ required: true, message: '违规人姓名', trigger: 'blur' }],
        violationType: [{ required: true, message: '请选择三违行为类型', trigger: 'change' }],
        violationTime: [{ required: true, message: '请违规发生时间', trigger: 'change' }],
        violationDeptId: [{ required: true, message: '请选择违规人部门', trigger: 'change' }],
        violationAddress: [{ required: true, message: '请填写违规发生地', trigger: 'change' }],
        description: [{ required: true, message: '请填写三违描述', trigger: 'blur' }]
      }
    }
  },
  computed: {
    ...mapGetters(['permission']),
    columns: () => registryColumns,
    hasSelected() {
      return this.selectedRowKeys.length > 0
    },
    rowSelection() {
      return {
        selectedRowKeys: this.selectedRowKeys
      }
    }
  },
  filters: {
    colorFilter: function(value) {
      const colorList = ['orange', 'green', 'blue', 'red']
      return colorList[value]
    },
    textFilter: function(value) {
      const textList = ['未提交', '已提交', '已处理', '关闭']
      return textList[value]
    }
  },
  mounted() {},
  methods: {
    //时间格式转换
    onChange(date, dateString) {
      this.commonData.violationTime = dateString
    },
    //上传照片
    handleCancelImg() {
      this.previewVisible = false
    },
    async handlePreview(file) {
      if (!file.url && !file.preview) {
        file.preview = await getBase64(file.originFileObj)
      }
      this.previewImage = file.url || file.preview
      this.previewVisible = true
      // 图片全屏预览
      /*const imageList = this.fileList.map(item => {
        return item.url
      })
      const curImageIndex = imageList.findIndex((item)=> {return item === file.url})
      this.$viewerApi({
        options: {
          navbar: true,
          fullscreen: false,
          inline: true,
          initialViewIndex: curImageIndex
        },
        images: imageList,
      })*/
    },
    handleChange({ fileList }) {
      this.fileList = fileList
      console.log(this.fileList)
    },
    beforeUpload(file) {
      const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'
      if (!isJpgOrPng) {
        this.$message.error('只能上传照片！')
      }
      return isJpgOrPng
    },
    // 获取人员数据
    getSelectOptions() {
      getPersonnelTree(0).then(res => {
        this.signOrgNameOptions = res.data
      })
    },

    initFormData() {
      this.commonData = {
        description: '',
        files: [],
        id: '',
        processTime: '',
        processorId: '',
        processorName: '',
        registerTime: '',
        registrantName: '',
        status: '',
        submitTime: '',
        submitterName: '',
        violationAddress: '',
        violationDeptId: '',
        violationDeptName: '',
        violationPersonId: '',
        violationPersonName: '',
        violationTime: '',
        violationType: ''
      }
    },
    commonInit() {
      this.commonVisible = false
      this.commonDisabled = false
      this.commonTitle = ''
      this.confirmLoading = false
      this.initFormData()
    },
    onSelectChange(selectedRowKeys, selectedRows) {
      this.selectedRowKeys = selectedRowKeys
      this.selectedRows = selectedRows
    },
    searchReset() {
      this.queryParam = {}
      this.$refs.table.refresh(true)
      this.$refs.table.clearSelected()
    },
    addRecord() {
      this.commonTitle = '新增数据'
      this.commonVisible = true
      this.commonDisabled = false
      this.filesList = false
      this.fileList = []
      this.initFormData()
    },
    //查看详情
    getRecord(id, callback) {
      this.filesList = false
      this.getById(ApiURLs.registry, id).then(({ data, success }) => {
        if (success) {
          this.commonData = JSON.parse(JSON.stringify(data))
          this.commonData.violationType = this.commonData.violationTypeName
          // console.log(this.commonData.files)
          var arr = []
          this.commonData.files.forEach(item => {
            arr.push({
              urlPath: item.filePath,
              id: item.id,
              originalFileName: item.fileName,
              realPath: '/spang-safety/file/' + item.filePath,
              uid: item.id,
              name: item.fileName,
              status: 'done',
              url: process.env.VUE_APP_API_BASE_URL + '/spang-safety/file/' + item.filePath
            })
          })
          this.fileList = arr
          callback()
        }
      })
    },
    viewFiles(record) {
      console.log(record.files)
      this.commonVisible = true
      this.commonDisabled = true
      this.filesList = true
      this.commonTitle = '查看附件'
      this.imgList = []
      // for (let item of record.files) {
      //   this.imgList.push({
      //     id: item.id,
      //     filePath: process.env.VUE_APP_API_BASE_URL + '/spang-safety/file/' + item.filePath,
      //   })
      // }
      this.imgList = record.files.map(item => process.env.VUE_APP_API_BASE_URL + '/spang-safety/file' + item.filePath)
      console.log(this.imgList)
    },
    viewRecord(record) {
      this.commonTitle = '查看数据'
      this.getRecord(record.id, () => {
        this.commonDisabled = true
        this.commonVisible = true
      })
      this.getById(ApiURLs.deal, record.id).then(({ data, success }) => {
        if (success) {
          this.publishData = JSON.parse(JSON.stringify(data))
          // this.publishData.type = this.publishData.type === 0 ? '警告' : '处罚'
        }
      })
    },
    editRecord(record) {
      this.commonTitle = '编辑数据'
      this.getRecord(record.id, () => {
        this.commonDisabled = false
        this.commonVisible = true
      })
    },
    removeRecord(record) {
      this.showDeleteConfirm(record.id)
    },
    modalCancel() {
      this.commonInit()
    },
    //保存
    modalOk(data) {
      let method = ''

      var formData = JSON.parse(JSON.stringify(this.commonData))
      if (this.isNotNullOrUndefined(this.commonData.id)) {
        method = 'put'
        this.$delete(formData, 'status')
      } else {
        method = 'post'
      }

      var arr = []
      console.log(this.fileList)
      for (let item of this.fileList) {
        if (item.response) {
          arr.push({
            fileUrlPath: item.response.data.urlPath,
            id: item.response.data.id,
            originalFileName: item.response.data.originalFileName
          })
        } else {
          arr.push({
            fileUrlPath: item.urlPath,
            id: item.id,
            originalFileName: item.originalFileName
          })
        }
      }
      formData.files = arr
      console.log(formData.files, 888)
      this.templateTypeNameOptions.forEach(item => {
        if (this.commonData.violationType === item.dictKey || this.commonData.violationType === item.dictValue) {
          formData.violationType = item.dictKey
        }
      })
      this.processorNameOptions.forEach(item => {
        if (this.commonData.processorName === item.id || this.commonData.processorName === item.realName) {
          this.commonData.processorId = item.id
        }
        if (this.commonData.violationPersonName === item.id || this.commonData.violationPersonName === item.realName) {
          this.commonData.violationPersonId = item.id
        }
      })
      this.getTreeName(this.signOrgNameOptions, formData.violationDeptId)

      const params = {
        ...formData,
        violationType: formData.violationType,
        processorId: this.commonData.processorId,
        violationPersonId: this.commonData.violationPersonId,
        violationDeptName: this.commonData.violationDeptName
      }
      this.$refs.ruleForm.validate(valid => {
        if (valid) {
          this.submitForm(ApiURLs.registry, params, method, {
            // headers: { 'Content-Type': 'multipart/form-data' }
          }).then(res => {
            this.$refs.table.refresh()
            this.$refs.table.clearSelected()
            this.commonInit()
          })
        } else {
          console.log('error submit!!')
          return false
        }
      })
    },
    //根据单位ID查询单位名称
    getTreeName(list, id) {
      let _this = this
      for (let i = 0; i < list.length; i++) {
        let a = list[i]
        if (a.id == id) {
          this.commonData.violationDeptName = a.title
        } else {
          if (a.children && a.children.length > 0) {
            let res = _this.getTreeName(a.children, id)
            if (res) {
              return res
            }
          }
        }
      }
    },
    //提交、撤回
    publishRecord(record, status) {
      if (record.processorName === '') {
        this.$message.warning('请先填写处理人')
        setTimeout(() => {
          this.editRecord(record)
        }, 1000)
      } else {
        var publishData = {
          status: status,
          id: record.id
        }
        this.submitForm(ApiURLs.registry, publishData, 'put').then(({ success }) => {
          if (success) {
            this.$message.success(`操作成功`)
            this.searchReset()
          }
        })
      }
    },
    showDeleteConfirm(params) {
      const _this = this
      this.$confirm({
        title: '确定执行删除操作?',
        content: ' ',
        okText: '是',
        okType: 'danger',
        cancelText: '否',
        onOk() {
          _this.deleteById(ApiURLs.registry, params).then(res => {
            if (res.code === 200) {
              _this.$message.success('删除成功')
              _this.selectedRows = []
              _this.selectedRowKeys = []
              _this.$refs.table.refresh()
            } else {
              _this.$message.error('删除失败')
            }
          })
        },
        onCancel() {
          console.log('Cancel')
        }
      })
    },
    onTimeChange(value, dateString) {},
    //关闭弹框
    handleCancelModal() {
      this.commonVisible = false
    }
  },
  created() {
    //
    getUsers().then(res => {
      this.processorNameOptions = res.data
    }),
      //三违行为类型
      this.getDict('PERIL_VIOLATE_TYPE').then(({ data, success }) => {
        if (success) {
          this.templateTypeNameOptions = data
        }
      })
    //违规人部门
    this.getSelectOptions()
  },
  watch: {
    commonVisible(val, newVal) {
      if (val) {
        try {
          this.$refs['ruleForm'].resetFields()
        } catch (e) {}
      }
    }
  }
}
</script>
<style lang="less" scoped>
/deep/ .ant-table {
  height: auto;
}

/deep/ .table-card .ant-card-body {
  padding-top: 0;
  padding-bottom: 15px;
}

/deep/.ant-col {
  //margin: 3px 0;
}
/deep/ .ant-modal-body {
  max-height: 700px;
  overflow-y: auto;
}
/deep/ .ant-table-body {
  //overflow-y: auto !important;
}
/deep/.ant-btn-primary[disabled] {
  display: none !important;
}
/deep/ .ant-form-item-label {
  //width: 104px !important;
}
.contentTitle {
  height: 40px;
  line-height: 40px;
  font-size: 16px;
  border-bottom: 1px solid #aaa;
  margin: 10px 0;
  color: blue;
}
/deep/ .filesList {
  ul {
    li {
      list-style: none;
      float: left;
      img {
        width: 100px;
        height: 100px;
      }
    }
  }
}
/deep/ .imgList .anticon-delete {
  display: none;
}
/deep/ .table-page-search-wrapper .ant-form-inline .ant-form-item > .ant-form-item-label {
  width: 92px;
}
</style>
