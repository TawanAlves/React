<template>
  <div>
    <a-card v-for="(item, index) in results" :key="item.id" style="margin-bottom: 10px;">
      <div class="d-flex">
        <span class="flex-grow-1">
          {{ index + 1 }}.
          <label-with-input :label="item.label" :label-values="item.labelValue"/>
        </span>
        <a-tag class="float-right" :color="item.status !== '未完成' ? '#108ee9' : '#f50'">
          {{ item.status }}
        </a-tag>
      </div>
      <div class="measure-content">
        <template v-if="item.measure.type !== 'textarea'">
          <span class="font-weight-bold measure-content-title"> 安全措施</span>
          <div class="measure-content-desc">
            <template v-for="(input, inputIndex) in item.measure.options">
              <div class="measure-content-item">
                <template v-if="item.measure.type === 'checkbox'">
                  <a-checkbox v-model="input.checked" :key="inputIndex"></a-checkbox>
                </template>
                <label-with-input :label="input.label" :label-values="input.labelValue" :key="inputIndex"/>
              </div>
            </template>
          </div>

        </template>
        <template v-else>
          <a-textarea
            v-model="item.measure.label"
            :auto-size="{ minRows: 3, maxRows: 3 }"
            disabled
            style="resize: none"
          />
        </template>
      </div>
      <div class="signature-content mb-10 evenly-display" v-for="(signature, index) in item.signatures" :key="index">
        <span>签字</span>
        <img :src="signature.signature" alt="" v-if="signature.signature">
        <span>{{ signature.time }}</span>
      </div>
    </a-card>
  </div>
</template>

<script>
import LabelWithInput from './LabelWithInput'
import { getRiskResult } from '@/api/safety'
export default {
  name: 'RiskDetail',
  components: { LabelWithInput },
  props: {
    taskNo: {
      type: String,
      required: true,
      default: ''
    }
  },
  data () {
    return {
      results: []
    }
  },
  mounted () {
    getRiskResult({
      taskNo: this.taskNo
    }).then(({ data }) => {
      // todo 测试数据开始
      this.results = [
        {
          id: '1',
          label: '可燃有毒介质名称$',
          labelValue: ['硫化氢'],
          status: '有',
          measure: {
            type: 'input',
            options: [
              {
                label: '已吹扫置换清理干净'
              }
            ]
          },
          signatures: [
            {
              signature: null,
              time: '2021-05-21 11:20'
            }
          ]
        },
        {
          id: '2',
          label: '动火设备、管道未与系统隔绝',
          status: '有',
          measure: {
            type: 'checkbox',
            options: [
              {
                label: '加盲板$块',
                labelValue: [1],
                checked: true
              },
              {
                label: '管线断开',
                checked: true
              },
              {
                label: '法兰断开',
                checked: false
              },
              {
                label: '其他',
                checked: false
              }
            ]
          },
          signatures: [
            {
              signature: null,
              time: '2021-05-21 11:20'
            }
          ]
        },
        {
          id: '3',
          label: '现场未准备消防灭火器材',
          status: '有',
          measure: {
            type: 'input',
            options: [
              {
                label: '配备消防蒸汽管$根',
                labelValue: [1]
              },
              {
                label: '铁锹$把',
                labelValue: [1]
              },
              {
                label: '灭火器$具',
                labelValue: [1]
              },
              {
                label: '防火毡$块',
                labelValue: [1]
              },
              {
                label: '消防水带$条',
                labelValue: [1]
              }
            ]
          },
          signatures: [
            {
              signature: null,
              time: '2021-05-21 11:20'
            }
          ]
        },
        {
          id: '4',
          label: '补充措施',
          status: '有',
          measure: {
            type: 'textarea',
            label: 'XXX'
          },
          signatures: [
            {
              signature: null,
              time: '2021-05-21 11:20'
            }
          ]
        }
      ]
      // 测试数据结束
    })
  }
}
</script>

<style scoped lang="less">
.d-flex {
  display: flex;
  .float-right {
    width: 75px;
    text-align: center;
  }
}
.flex-grow-1 {
  flex-grow: 1;
}
.font-weight-bold {
  font-weight: bolder;
  font-size: 15px;
}
.measure-content {
  margin: 10px 0;
}
.evenly-display {
  display: flex;
  justify-content: space-evenly;
  img {
    width: 100px;
    height: 30px;
  }
  span {
    width: 30%;
  }
}
.mx-10 {
  margin: 0 10px;
}
.measure-content {
  display: flex;
  .measure-content-title {
    display: block;
    width: 100px;
    text-align: center;
  }
  .measure-content-desc {
    flex-grow: 1;
  }
  .measure-content-item {
    display: inline-block;
    width: 30%;
    margin-right: 10px;
    line-height: 1.4;
  }
}
</style>
