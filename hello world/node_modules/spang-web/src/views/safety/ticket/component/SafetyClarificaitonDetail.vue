<template>
  <div>
    <a-card title="一、可能存在的事故风险种类（勾选可能存在的事故种类）" :extra="false">
      <table style="width: 100%">
        <tr>
          <th></th>
          <th>类型</th>
          <th>危险因素</th>
        </tr>
        <tr v-for="item in risks" :key="item.type">
          <td>
            <a-checkbox v-model="item.checked"/>
          </td>
          <td>{{ item.type }}</td>
          <td>{{ item.riskFactor }}</td>
        </tr>
      </table>
    </a-card>
    <a-card title="二、风险防范措施交底（选择需要采取的安全措施" :extra="false" class="mt-10">
      <table>
        <tr v-for="item in measures" :key="item.label">
          <td width="40">
            <a-checkbox v-model="item.checked"/>
          </td>
          <td>
            {{ item.label }} {{ item.content }}
          </td>
        </tr>
      </table>
    </a-card>

    <div class="mt-10 evenly-display">
      <span>作业单位安全教育人</span>
      <img :src="taskUnitSafety.person" alt="" v-if="taskUnitSafety.person">
      <span>{{ taskUnitSafety.time }}</span>
    </div>
    <div class="mt-10 evenly-display">
      <span>所在单位安全教育人</span>
      <img :src="beyondUnitSafety.person" alt="" v-if="taskUnitSafety.person">
      <span>{{ beyondUnitSafety.time }}</span>
    </div>
  </div>
</template>

<script>
import { getSafetyClarification } from '@/api/safety'
export default {
  name: 'SafetyClarificaitonDetail',
  props: {
    taskNo: {
      type: String,
      required: true,
      default: ''
    }
  },
  data () {
    return {
      loading: true,
      risks: [
        {
          checked: false,
          type: '火灾事故',
          riskFactor: ''
        },
        {
          checked: false,
          type: '中毒或窒息',
          riskFactor: ''
        },
        {
          checked: false,
          type: '触电事故',
          riskFactor: ''
        },
        {
          checked: false,
          type: '车辆伤害',
          riskFactor: ''
        },
        {
          checked: false,
          type: '起重伤害',
          riskFactor: ''
        },
        {
          checked: false,
          type: '淹溺事故',
          riskFactor: ''
        }
      ],
      measures: [
        {
          checked: false,
          label: '特殊作业前办理作业票，并持票作业。'
        },
        {
          checked: false,
          label: '清除动火地点周围易燃物。'
        },
        {
          checked: false,
          label: '加盲板隔离或与有毒、易燃介质管线断开。'
        },
        {
          checked: false,
          label: '测氧测爆有毒气体分析合格。'
        },
        {
          checked: false,
          label: '通氮气或蒸汽进行保护。'
        },
        {
          checked: false,
          label: '分析与动火间隔不得超过30分钟，如超过或动火间断超过30分钟，或作业条件发生变化，应重新分析。'
        },
        {
          checked: false,
          label: '受限空间每两小时分析一次。'
        },
        {
          checked: false,
          label: '分析要有代表性，构架或大型容器应在上中下分别采样分析。'
        },
        {
          checked: false,
          label: '动火点15米内不得有可燃液体排放，30米内不得有可燃气体排放。'
        },
        {
          checked: false,
          label: '其他安全措施、作业方案要求落实的补充内容或事故案例警示内容：',
          content: ''
        }
      ],
      taskUnitSafety: {
        person: '',
        time: ''
      },
      beyondUnitSafety: {
        person: '',
        time: ''
      }
    }
  },
  mounted () {
    getSafetyClarification({ taskNo: this.taskNo }).then(({ data }) => {
      // TODO 测试数据
      data.risks = [
        {
          checked: true,
          type: '火灾事故',
          riskFactor: 'abc'
        }
      ]
      data.beyondUnitSafety = {
        person: '',
        time: '2021-05-21 11:20'
      }
      // 测试数据结束
      this.risks = Object.assign({}, this.risks, data.risks)
      this.measures = Object.assign({}, this.measures, data.measures)
      this.taskUnitSafety = Object.assign({}, this.taskUnitSafety, data.taskUnitSafety)
      this.beyondUnitSafety = Object.assign({}, this.beyondUnitSafety, data.beyondUnitSafety)
    })
  }
}
</script>

<style lang="less" scoped>
.mt-10 {
  margin-top: 10px;
}
.evenly-display {
  display: flex;
  justify-content: space-evenly;
  img {
    width: 100px;
    height: 30px;
  }
  span {
    width: 30%;
  }
}
</style>
