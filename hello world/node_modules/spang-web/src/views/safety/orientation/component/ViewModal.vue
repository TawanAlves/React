<template>
  <a-modal
    :title="modalTitle"
    :width="1200"
    :visible="visible"
    :confirmLoading="loading"
    @cancel="() => { $emit('cancel') }"
    :bodyStyle="{ height: '500px'}"
    :keyboard="false"
    :maskClosable="false"
  >
    <template slot="footer">
      <a-button type="primary" @click.stop="()=>{ $emit('ok') }">返回</a-button>
    </template>
    <a-spin :spinning="loading">
      <div>
        <s-table
          ref="table"
          :rowKey="id"
          :scroll="{x: 1000,y: 400}"
          :columns="columns"
          :showPagination="false"
          :data="loadData">
        </s-table>
      </div>
    </a-spin>
  </a-modal>
</template>

<script>
import { personEducation } from '@/api/safety'
import { certificateColumns, educationColumns } from '@/views/safety/table'
import { STable } from '@/components'

export default {
  name: 'ViewModal',
  components: {
    STable
  },
  props: {
    visible: {
      type: Boolean,
      required: true
    },
    loading: {
      type: Boolean,
      default: () => false
    },
    modalTitle: {
      type: String,
      default: '操作'
    },
    mode: {
      type: Boolean,
      default: false
    },
    personId: {
      type: String,
      default: () => null
    }
  },
  data () {
    return {
      loadData: () => {
        if (this.mode) {
          return personEducation.getPersonEduCertificate(this.personId).then(res => {
            return { data: res.data }
          })
        } else {
          return personEducation.getPersonEduEducation(this.personId).then(res => {
            return { data: res.data }
          })
        }
      }
    }
  },
  computed: {
    columns: function () {
      return this.mode ? certificateColumns.slice(0, -1) : educationColumns.slice(0, -1)
    }
  },
  watch: {
    'visible': {
      handler (val) {
        console.log(this.$refs.table)
        if (val) {
          console.log('刷新数据', this.$refs.table)
          this.$refs.table.refresh(true)
        }
      }
    }
  }
}
</script>
<style lang="less" scoped>
/deep/ .ant-table {
  height: 400px!important;
}
/deep/.ant-table-wrapper {
  //height:
}
</style>
