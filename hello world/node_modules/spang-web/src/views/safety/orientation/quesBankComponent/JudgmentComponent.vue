<template>
  <a-form-model ref="dynamicValidateForm" :model="dynamicValidateForm" v-bind="formItemLayoutWithOutLabel">
    <a-form-model-item
      v-for="(domain, index) in dynamicValidateForm.domains"
      :key="domain.key"
      v-bind="index === 0 ? formItemLayout : {}"
      :label="index === 0 ? '答案选项' : ''"
      :prop="'domains.' + index + '.value'"
      :rules="{
        required: true,
        message: '请输入答案',
        trigger: 'blur',
      }"
    >
      <div class="select-item">
        <a-radio :checked="domain.checked" @click="onClick(domain, index)"> {{ domain.value }}</a-radio>
      </div>
    </a-form-model-item>
  </a-form-model>
</template>

<script>
export default {
  props: {
    isEdit: {
      type: Boolean,
      required: true,
    },
    defaultAnsList: {
      type: Object, // 默认表单数据
      default: () => null,
    },
  },
  data() {
    return {
      formItemLayout: {
        labelCol: {
          xs: { span: 6 },
          sm: { span: 6 },
        },
        wrapperCol: {
          xs: { span: 4 },
          sm: { span: 4 },
        },
      },
      formItemLayoutWithOutLabel: {
        wrapperCol: {
          xs: { span: 14, offset: 6 },
          sm: { span: 14, offset: 6 },
        },
      },

      dynamicValidateForm: {
        domains: [
          { key: '1', value: '正确', checked: false, contentAll: {} },
          { key: '2', value: '错误', checked: false, contentAll: {} },
        ],
      },
      answerList: [],
    }
  },
  watch: {
    defaultAnsList: {
      //监听的对象
      deep: true, //深度监听设置为 true
      handler: function (newV, oldV) {
        this.setFormData(newV)
      },
    },
  },
  mounted() {
    this.setFormData(this.defaultAnsList)
  },
  methods: {
    setFormData(newV) {
      if (!this.isEdit) {
        this.resetForm()
        return
      }
      let list = JSON.parse(JSON.stringify(newV))
      let listArr = []
      list.forEach((element) => {
        let { id, isRight, content } = element
        listArr.push({
          key: id,
          value: content,
          checked: isRight == 1 ? true : false,
          contentAll: element,
        })
      })
      this.dynamicValidateForm.domains = JSON.parse(JSON.stringify(listArr))
    },
    submitForm(formName) {
      let flag = false
      this.$refs.dynamicValidateForm.validate((valid) => {
        if (valid) {
          let list = JSON.parse(JSON.stringify(this.dynamicValidateForm.domains))
          this.answerList = []
          for (let index = 0; index < list.length; index++) {
            const element = list[index]
            let { key, value, checked, contentAll } = element
            let obj = contentAll
            obj.content = value
            obj.isRight = checked ? 1 : 0
            obj.orderId = index
            this.answerList.push(obj)
          }
          flag = true
        } else {
          flag = false
        }
      })
      return flag
    },
    onClick(domain, index) {
      let list = this.dynamicValidateForm.domains
      for (let index = 0; index < list.length; index++) {
        const element = list[index]
        this.dynamicValidateForm.domains[index].checked = false
      }
      if (this.dynamicValidateForm.domains[index].checked) {
        this.dynamicValidateForm.domains[index].checked = false
      } else {
        this.dynamicValidateForm.domains[index].checked = true
      }
    },
    resetForm(formName) {
      this.$refs.dynamicValidateForm.resetFields()
    },
  },
}
</script>
<style lang="less" scoped>
.dynamic-delete-button {
  cursor: pointer;
  position: relative;
  top: 4px;
  font-size: 24px;
  color: #999;
  transition: all 0.3s;
}
.dynamic-delete-button:hover {
  color: #777;
}
.dynamic-delete-button[disabled] {
  cursor: not-allowed;
  opacity: 0.5;
}
.select-item {
  display: inline-flex;
  flex-direction: row;
  align-items: center;

  .selectTag,
  .selectDelTag {
    margin: 0 8px;
  }
  .selectDelTag {
    cursor: pointer;
    color: red;
  }
}
</style>
