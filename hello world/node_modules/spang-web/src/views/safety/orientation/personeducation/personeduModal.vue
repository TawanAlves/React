<template>
  <a-modal
    :title="modalTitle"
    :width="1200"
    :visible="visible"
    :confirmLoading="false"
    :keyboard="false"
    :maskClosable="false"
    @cancel="
      () => {
        $emit('cancel')
      }
    "
    :bodyStyle="{ maxHeight: '600px', overflow: 'auto', paddingTop: '5px' }"
  >
    <template slot="footer">
      <a-button
        @click.stop="
          () => {
            $emit('ok')
          }
        "
        >取消</a-button
      >
    </template>

    <a-form layout="inline">
      <a-row :gutter="16">
        <a-col :md="8">
          <a-form-item label="姓名">
            <a-input v-model="form.name" :disabled="true" />
          </a-form-item>
        </a-col>
        <a-col :md="8">
          <a-form-item label="部门">
            <a-input v-model="form.deptName" :disabled="true" />
          </a-form-item>
        </a-col>
      </a-row>
      <a-row :gutter="16">
        <a-col :md="8">
          <a-form-item label="性别">
            <!-- <a-select v-model="form.sextype" style="width: 100%" :disabled="true">
              <a-select-option v-for="d in sextypeOptions" :key="d.dictKey">
                {{ d.dictValue }}
              </a-select-option>
            </a-select> -->
            <a-input v-model="form.sextype" :disabled="true" />
          </a-form-item>
        </a-col>
        <a-col :md="8">
          <a-form-item label="岗位">
            <a-input v-model="form.postName" :disabled="true" />
          </a-form-item>
        </a-col>
      </a-row>
    </a-form>

    <!-- 三级安全教育培训信息 -->
    <div class="personedu-modal">
      <div class="personedu-modal-title">三级安全教育培训信息</div>
      <a-table
        ref="table1"
        :rowKey="(record) => record.id"
        :scroll="{ y: 200 }"
        :columns="safetyEducationColumns"
        :pagination="false"
        :data-source="safetyEducationData"
      >
        <template slot="examResult" slot-scope="text, record">
          <div v-if="record.examResult == 0">未通过</div>
          <div v-else-if="record.examResult == 1">通过</div>
          <div v-else></div>
        </template>
      </a-table>
    </div>
    <!-- 证书信息 -->
    <div class="personedu-modal">
      <div class="personedu-modal-title">证书信息</div>
      <a-table
        ref="table2"
        :rowKey="(record) => record.id"
        :scroll="{ y: 200 }"
        :columns="workCertListColumns"
        :pagination="false"
        :data-source="workCertListData"
      >
        <span slot="action" slot-scope="text, record">
          <template>
            <a @click="educationCheck(record)">查看</a>
          </template>
        </span>
      </a-table>
    </div>

    <!-- 培训记录 -->
    <div class="personedu-modal">
      <div class="personedu-modal-title">培训记录</div>
      <a-table
        ref="table3"
        :rowKey="(record) => record.id"
        :scroll="{ y: 200 }"
        :columns="trainingCrodColumns"
        :pagination="false"
        :data-source="trainingloadData"
      >
        <template slot="trainTime" slot-scope="text, record">
          <div>{{ record.trainStartDate + '~' + record.trainEndDate }}</div>
        </template>
        <!-- trainWay 培训形式(0线上/1线下) -->
        <template slot="trainWay" slot-scope="text, record">
          <div v-if="record.trainWay == 0">线上</div>
          <div v-else-if="record.trainWay == 1">线上</div>
          <div v-else></div>
        </template>
      </a-table>
    </div>
    <!-- 考试记录 -->
    <div class="personedu-modal">
      <div class="personedu-modal-title">考试记录</div>
      <a-table
        ref="table4"
        :rowKey="(record) => record.id"
        :scroll="{ y: 200 }"
        :columns="examUserListColumns"
        :pagination="false"
        :data-source="examUserListData"
      >
        <!-- 考试形式  0 线上1线下  -->
        <template slot="examShape" slot-scope="text, record">
          <div v-if="record.examShape == 0">线上</div>
          <div v-else-if="record.examShape == 1">线下</div>
          <div v-else></div>
        </template>
        <!-- 考试结果 -->
        <template slot="examResult" slot-scope="text, record">
          <div v-if="record.examResult == 0">缺考</div>
          <div v-else-if="record.examResult == 1">未通过</div>
          <div v-else-if="record.examResult == 2">通过</div>
          <div v-else></div>
        </template>
      </a-table>
    </div>
    <!-- 三违记录 -->
    <div class="personedu-modal">
      <div class="personedu-modal-title">三违记录</div>
      <a-table
        ref="table5"
        :rowKey="(record) => record.id"
        :scroll="{ y: 200 }"
        :columns="violationsListColumns"
        :pagination="false"
        :data-source="violationsListData"
      >
      </a-table>
    </div>
    <!-- 查看照片 -->
    <personeduDetail
      :visible="workCertvisible"
      :imageList="imageList"
      :info="workCertInfo"
      @cancel="personeduDetailcancel"
    ></personeduDetail>
  </a-modal>
</template>

<script>
import {
  trainingColumns,
  safetyEducationColumns,
  workCertListColumns,
  examUserListColumns,
  violationsListColumns,
} from './table'
import personeduDetail from './personeduDetail'
export default {
  name: 'ViewModal',
  components: { personeduDetail },
  props: {
    visible: {
      type: Boolean,
      required: true,
    },
    modalTitle: {
      type: String,
      default: '操作',
    },

    formData: {
      type: Object, // 默认表单数据
      default: () => null,
    },
  },
  data() {
    return {
      form: {
        name: '',
        deptName: '',
        sextype: '',
        postName: '',
      },
      sextypeOptions: [
        { dictKey: 1, dictValue: '男' },
        { dictKey: 2, dictValue: '女' },
      ],
      // 三级安全教育培训信息
      safetyEducationData: [],
      // 证书信息
      workCertListData: [],
      // 培训记录
      trainingloadData: [],
      // 考试记录
      examUserListData: [],
      //  三违记录
      violationsListData: [],
      workCertInfo: {},
      workCertvisible: false,
      imageList: [],
    }
  },
  computed: {
    trainingCrodColumns: () => trainingColumns,
    safetyEducationColumns: () => safetyEducationColumns,
    workCertListColumns: () => workCertListColumns,
    examUserListColumns: () => examUserListColumns,
    violationsListColumns: () => violationsListColumns,
  },
  created() {
    this.workCertvisible = false
  },
  mounted() {
    this.setFormData(this.formData)
  },
  watch: {
    formData: {
      //监听的对象
      deep: true, //深度监听设置为 true
      handler: function (newV, oldV) {
        this.setFormData(newV)
      },
    },
  },
  methods: {
    educationCheck(record) {
      // this.workCertvisible = true
      // this.workCertInfo = {
      //   fileList: [{ fileId: record.fileId, fileName: record.fileName, filePath: record.filePath }],
      // }
      this.imageList = []
      this.imageList.push(this.BASE_URL + '/spang-safety/file' + record.filePath)
      this.$viewerApi({
        options: {
          navbar: false,
          fullscreen: false,
          inline: true
        },
        images: this.imageList,
      })
    },
    personeduDetailcancel() {
      this.workCertvisible = false
    },
    setFormData(formData) {
      let data = JSON.parse(JSON.stringify(formData))
      let { userName, deptName, sex, postName, educationList, workCertList, trainList, examList, violationsList } = data
      this.form.name = userName
      this.form.deptName = deptName
      this.form.sextype = sex
      this.form.postName = postName

      // 三级安全教育培训信息
      this.safetyEducationData = educationList
      // 证书信息
      this.workCertListData = workCertList
      // 培训记录
      this.trainingloadData = trainList
      // 考试记录
      this.examUserListData = examList
      //  三违记录
      this.violationsListData = violationsList
    },
  },
}
</script>
<style lang="less" scoped>
/deep/ .ant-table {
  height: auto;
}

/deep/ .table-card .ant-card-body {
  padding-top: 0;
  padding-bottom: 15px;
}
/deep/.ant-table-body {
  margin: 0 !important;
}
.personedu-modal-title {
  padding: 5px;
  margin: 10px 0px;
  border-bottom: 1px solid #e5e3e3;
  font-size: 16px;
  color: blue;
}
</style>
