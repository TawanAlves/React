<template xmlns:a-col="http://www.w3.org/1999/html">
  <div>
    <a-card size="small" style="background-color: #06195e" bordered="false">
      <a-row type="flex" justify="center" style="margin: 4px 0 12px 0">
        <a-col :grid="{gutter: 8,xxl:2,xl:2 ,lg: 2, md: 2, sm: 1, xs: 1}">
          <a-radio-group default-value="tankFarm" button-style="solid" @change="onChange">
            <a-radio-button class="my-btn" value="tankFarm">重大危险源罐区</a-radio-button>
            <a-radio-button class="my-btn" value="gas">有毒可燃</a-radio-button>
            <a-radio-button class="my-btn" value="technology">重点监管危化工艺</a-radio-button>
          </a-radio-group>
        </a-col>
        <a-col :span="24">
          <span style="color: #fdfdfd;width: 100%;text-align: right;font-size: larger;float: right;padding-right: 20px">{{ currentTime }} </span>
          <!--          <span style="color: #fdfdfd;width: 100%;text-align: right;font-size: larger;float: right">刷新时间：{{ refreshTime }} </span>-->
        </a-col>
      </a-row>
      <a-row :gutter="24">
        <a-col :span="24">
          <div class="danger-list">
            <div v-show="tabKey==='tankFarm'" style="padding-right:8px">
              <a-list
                bordered="true"
                rowKey="id"
                :grid="{gutter: 8,xxl:2,xl:2 ,lg: 2, md: 2, sm: 1, xs: 1}"
                :dataSource="dataSource['tank']"
                size="small"
                split="true"
                style="background-color: #06195e"
              >
                <a-list-item slot="renderItem" slot-scope="item">
                  <template>
                    <a-card :hoverable="false" style="background-color: #06195e; border: .08333rem solid #20edfa;box-shadow: 0 0 0.5rem #20edfa;" bordered="true">
                      <a-card-meta>
                        <div slot="avatar">
                          <div class="avatar-img">
                            <img src="../../../../static/tank.svg" class="back-img"/>
                            <img src="../../../../static/正常.svg" class="status-img" v-show="item.equipRunStatusName === '正常'">
                            <img src="../../../../static/停用.svg" class="status-img" v-show="item.equipRunStatusName === '停用'">
                            <img src="../../../../static/异常.svg" class="status-img" v-show="item.equipRunStatusName !== '停用' && item.equipRunStatusName !== '正常'">
                          </div>
                          <div>
                            <p style="width: 120px;color: rgba(255,255,255,0.8);text-align: center">{{ item.equipName }}</p>
                          </div>
                        </div>
                        <!--              <a slot="title">{{ item.title }}</a>-->
                        <!--                    <a-avatar  shape="square" class="card-avatar" slot="avatar" src="../../../../static/1.png" size="large"/>-->
                        <div class="meta-content" slot="description">
                          <a-row :gutter="8">
                            <a-col :span="18">
                              <a-descriptions :column="2" class="basic">
                                <a-descriptions-item label="罐的容积">{{ item.reserves }} {{ item.reservesUnit }}</a-descriptions-item>
                                <a-descriptions-item label="压力类型">{{ item.pressureTypeName }}</a-descriptions-item>
                                <a-descriptions-item label="设计压力">{{ item.pressureDesign < 0?'\u00a0-\u00a0': item.pressureDesign }} Mpa</a-descriptions-item>
                                <a-descriptions-item label="最高工作压力">{{ item.pressureMax < 0?' - ': item.pressureMax }} Mpa</a-descriptions-item>
                                <a-descriptions-item label="温度类型">{{ item.temperatureTypeName }}</a-descriptions-item>
                                <a-descriptions-item label="设计温度低限">{{ item.temperatureMin }} ℃</a-descriptions-item>
                                <a-descriptions-item label="设计温度高限">{{ item.temperatureMax }} ℃</a-descriptions-item>
                                <a-descriptions-item label="设备内材质">{{ item.medium }}</a-descriptions-item>
                                <a-descriptions-item label="介质形态">{{ item.mediumStatusName }}</a-descriptions-item>
                              </a-descriptions>
                            </a-col>
                            <!--                        <a-col :span="1">-->
                            <!--                          <a-divider type="vertical" style="height: 9rem;background-color: #0BB7AF"/>-->
                            <!--                        </a-col>-->
                            <a-col :span="6">
                              <a-descriptions :column="1" class="record">
                                <a-descriptions-item v-for="d in item.sensorVOList" :label="d.typeName">
                                  <a-tooltip overlayClassName="danger-tooltip" arrow-point-at-center destory-tooltip-on-hide>
                                    <div slot="title" class="popover-inner">
                                      <a-descriptions :column="1" >
                                        <a-descriptions-item label="监测指标">{{ d.typeName }}</a-descriptions-item>
                                        <a-descriptions-item label="实时值">{{ d.lastValue }} {{ d.unit }}</a-descriptions-item>
                                        <a-descriptions-item label="阈值上限">{{ d.thresholdUp }} {{ d.unit }}</a-descriptions-item>
                                        <a-descriptions-item label="阈值下限" v-if="d.targetType === 'WD'">{{ d.thresholdDown }} {{ d.unit }}</a-descriptions-item>
                                        <a-descriptions-item label="阈值下限" v-else>{{ d.thresholdDown < 0 ?'\u00a0-\u00a0': d.thresholdDown }} {{ d.unit }}</a-descriptions-item>
                                        <a-descriptions-item label="量程">{{ d.rangeDown }} {{ d.unit }} ~ {{ d.rangeUp }} {{ d.unit }}</a-descriptions-item>
                                        <a-descriptions-item label="采集时间">{{ d.lastCollectTime }}</a-descriptions-item>
                                        <a-descriptions-item label="更新时间">{{ d.lastValueUpdateTime }}</a-descriptions-item>
                                      </a-descriptions>
                                    </div>
                                    <a @mouseover="showDetail" style="color: #00b300">{{ d.lastValue }} {{ d.unit }}</a>
                                  </a-tooltip>
                                </a-descriptions-item>
                              </a-descriptions>
                            </a-col>
                          </a-row>
                        </div>
                      </a-card-meta>
                    </a-card>
                  </template>
                </a-list-item>
              </a-list>
            </div>
            <div v-show="tabKey==='gas'" style="padding-right:8px" class="gas-content">
              <a-list
                bordered="true"
                rowKey="id"
                :grid="{gutter: 8,xxl:6,xl:4 ,lg: 2, md: 2, sm: 1, xs: 1}"
                :dataSource="dataSource['gas']"
                size="small"
                split="true"
                style="background-color: #06195e;"
              >
                <a-list-item slot="renderItem" slot-scope="item">
                  <a-card bordered="true" style="background-color: #06195e; border: .08333rem solid #20edfa;box-shadow: 0 0 0.5rem #20edfa;" >
                    <a-card-meta>
                      <div slot="avatar" >
                        <div class="gas-img" v-show="item.sensorVOList[0].valueQualityStatusName === '正常'">
                          <img src="../../../../static/alarm.svg" class="alarm">
                          <img src="../../../../static/正常.svg" class="status">
                        </div>
                        <div class="gas-img" v-show="item.sensorVOList[0].valueQualityStatusName !== '正常'">
                          <img src="../../../../static/alarm.svg" class="alarm">
                          <img src="../../../../static/正常.svg" class="status">
                        </div>
                        <div>
                          <p style="color: rgba(255,255,255,0.8);text-align: center;margin-top: 1.5rem">{{ item.sensorVOList[0].targetName }}</p>
                        </div>
                      </div>
                    </a-card-meta>
                  </a-card>
                </a-list-item>
              </a-list>
            </div>
            <div v-show="tabKey==='technology'">
              <a-list
                :data-source="dataSource['process']"
              >
                <a-list-item slot="renderItem" slot-scope="item">
                  <a-card style="background-color: #06195e;" :bordered="false">
                    <!--                    <div slot="title">-->
                    <!--                      <a-divider type="vertical"></a-divider>{{ item.equipName }}-->
                    <!--                    </div>-->
                    <a-card-meta>
                      <div slot="title" style="color: #fdfdfd;font-size: 24px;">
                        <a-divider type="vertical" style="background-color: #20edfa;width: 10px;height: 24px"/>{{ item.equipName }}
                      </div>
                      <a-descriptions slot="description" class="technology" style="border: .08333rem solid #20edfa;box-shadow: 0 0 0.5rem #20edfa;font-size: 20px">
                        <a-descriptions-item v-for="d in item.sensorVOList" :label="d.targetName">
                          <a-tooltip overlayClassName="technology-tooltip">
                            <div slot="title" class="popover-inner">
                              <a-descriptions :column="1">
                                <a-descriptions-item label="监测指标">{{ d.typeName }}</a-descriptions-item>
                                <a-descriptions-item label="实时值">{{ d.lastValue }} {{ d.unit }}</a-descriptions-item>
                                <a-descriptions-item label="阈值上限">{{ d.thresholdUp }} {{ d.unit }}</a-descriptions-item>
                                <a-descriptions-item label="阈值下限" v-if="d.targetType === 'WD'">{{ d.thresholdDown }} {{ d.unit }}</a-descriptions-item>
                                <a-descriptions-item label="阈值下限" v-else>{{ d.thresholdDown < 0 ?'\u00a0-\u00a0': d.thresholdDown }} {{ d.unit }}</a-descriptions-item>
                                <a-descriptions-item label="量程">{{ d.rangeDown }} {{ d.unit }} ~ {{ d.rangeUp }} {{ d.unit }}</a-descriptions-item>
                                <a-descriptions-item label="采集时间">{{ d.lastCollectTime }}</a-descriptions-item>
                                <a-descriptions-item label="更新时间">{{ d.lastValueUpdateTime }}</a-descriptions-item>
                              </a-descriptions>
                            </div>
                            <a style="color: #00b300">{{ d.lastValue }} {{ d.unit }}</a>
                          </a-tooltip>
                        </a-descriptions-item>
                      </a-descriptions>
                    </a-card-meta>
                  </a-card>
                </a-list-item>
              </a-list>
            </div>
          </div>
        </a-col>
        <!--        <a-col :span="2">-->
        <!--          <a-row style="margin: 4px 0">-->
        <!--&lt;!&ndash;            <a-button style="background-color: #0BB7AF" disabled="true"></a-button>&ndash;&gt;-->
        <!--            <img src="../../../../static/红.png" style="width: 60px"/>-->
        <!--            <span style="margin-left: 10px;color: #fdfdfd">高高报</span>-->
        <!--          </a-row>-->
        <!--          <a-row style="margin: 4px 0">-->
        <!--            <img src="../../../../static/青.png" style="width: 60px"/>-->
        <!--            <span style="margin-left: 10px;color: #fdfdfd">高高报</span>-->
        <!--          </a-row>-->
        <!--        </a-col>-->
      </a-row>
    </a-card>
  </div>
</template>

<script>
import Important from '@/views/safety/important/Important'
import { getRealtimeList } from '@/api/safety'

export default {
  name: 'RealtimeStatus',
  components: { Important },
  data () {
    return {
      extraImage: 'https://gw.alipayobjects.com/zos/rmsportal/RzwpdLnhmvDJToTdfDPe.png',
      dataSource: [],
      dataSource1: [],
      tool: {
        width: '300px',
        backgroundColor: 'blue',
        border: '.08333rem solid #20edfa !important'
      },
      refreshTime: '00:00:00',
      currentTime: '',
      tabKey: 'tankFarm'
    }
  },
  created () {
    this.loadData()
  },
  mounted () {
    this.timer = window.setInterval(() => {
      this.autoRefresh()
      // console.log('外部执行')
      // setTimeout(() => {
      //   console.log(
      //     '内部执行'
      //   )
      //   this.loadData()
      // },10000)
    }, 1000)
  },
  methods: {
    loadData () {
      getRealtimeList().then(res => {
        this.dataSource = res.data
        // this.loading = false
        // this.dataSource1 =res.data['有毒可燃气体']
      })
    },
    showDetail () {
      console.log('!!!!!!!!!!!')
    },
    getPopupContainer (trigger) {
      return trigger.parentElement
    },
    autoRefresh () {
      const date = new Date()
      let hour = date.getHours()
        let minute = date.getMinutes()
        let second = date.getSeconds()
      if (hour < 10) hour = '0' + hour
      if (minute < 10) minute = '0' + minute
      if (second < 10) second = '0' + second
      this.currentTime = hour + ':' + minute + ':' + second
      console.log('当前时间:' + this.currentTime)
      if (minute % 5 === 1 && second === 0) {
        this.refreshTime = this.currentTime
        setTimeout(() => {
          this.loadData()
        }, 0)
      }
    },
    onChange (e) {
      this.tabKey = e.target.value
    }
  },
  filters: {
    styleFilter (value) {
      if (value > 80) {
        return { 'background-color': '#d81e06', 'color': '#fdfdfd' }
      } else if (value > 50) {
        return { 'background-color': '#0BB7AF', 'color': '#fdfdfd' }
      } else {
        return { 'color': '#ffffff' }
      }
    }
  },
  destroyed () {
    window.clearInterval(this.timer)
  }
}
</script>

<style lang="less" scoped>
@import "~@/components/index.less";

.card-list {
  /deep/ .ant-card-body:hover {
    .ant-card-meta-title > a {
      color: @primary-color;
    }
  }

  /deep/ .ant-card-meta-title {
    margin-bottom: 12px;

    & > a {
      display: inline-block;
      max-width: 100%;
      color: rgba(0, 0, 0, .85);
    }
  }

  /deep/ .meta-content {
    position: relative;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    height: 64px;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;

    margin-bottom: 1em;
  }
}

.card-avatar {
  width: 120px;
  height: 120px;
  //border-radius: 48px;
}

.ant-card-actions {
  background: #f7f9fa;

  li {
    float: left;
    text-align: center;
    margin: 12px 0;
    color: rgba(0, 0, 0, 0.45);
    width: 50%;

    &:not(:last-child) {
      border-right: 1px solid #b70b11;
    }
    &:hover {
      //color: @primary-color;
      cursor: default;
      color: #b70b1c;
    }

    a {
      color: rgba(0, 0, 0, .45);
      line-height: 22px;
      display: inline-block;
      width: 100%;

      &:hover {
        //color: @primary-color;
        cursor: default;
        color: #0BB7AF;
      }
    }
  }
}

.new-btn {
  background-color: #fff;
  border-radius: 2px;
  width: 100%;
  height: 188px;
}
.ant-card {
  //padding: 24px;
  .ant-card-body {
    .ant-row {
      .ant-col {
        .ant-btn {
          &:hover {
            color: rgb(0, 179, 0,0.4);
          }
          &:focus {
            color: #fdfdfd;
          }
        }
      }
    }
  }
}
/deep/ .ant-list-item {
  background-color: #06195e;
  padding: 0 3px !important;
  margin: 3px 0 !important;
}
/deep/ p {
  margin-bottom: 0.5em;
  font-size: 15px;
  font-weight: bold;
}
.my-btn {
  margin:0 4px;
  background-color: #257d25;
  color: #0c0f1a;
  border-color: #257d25;
  font-weight: bold;
  box-shadow: deepskyblue;
  &:hover {
    color: #0c0f1a!important;
    border-color: #00b300!important;
    background-color: #00b300!important;
    //&:before {
    //}
    //&:after {
    //  color: #d31523 !important;
    //  border-color: #00b300;
    //  background-color: #00b300;
    //}
  }
  &:active {
    color: #0c0f1a!important;
    border-color: #00b300;
    background-color: #00b300;
  }
  &:focus {
    color: #0c0f1a!important;
    border-color: #00b300!important;
    background-color: #00b300!important;
  }
}
.ant-radio-group-solid {
  /deep/.ant-radio-button-wrapper {
      &::before {
        width: 0!important;
      }
  }
  .ant-radio-button-wrapper-checked {
    background-color: #00b300;
    color: #0c0f1a;
    border-color: #00b300;
  }
}

.basic {
  display: flex;
  /deep/ .ant-descriptions-item {
    padding-bottom: 5px;
  }
  /deep/.ant-descriptions-item-label {
    width: 110px;
    font-size: 15px;
    color: #0BB7AF;
    //font-weight: bolder;
    text-align: right;
  }
  /deep/ .ant-descriptions-item-content {
    width: 100px;
    font-size: 15px;
    color: #fdfdfd;
    margin-top: 3px;
    //font-weight: bolder;
    //word-break: keep-all; /* 不换行 */
    //white-space: nowrap; /* 不换行 */
    //overflow: hidden; /* 内容超出宽度时隐藏超出部分的内容 */
    //text-overflow: ellipsis;

  }
}
.record {
  /deep/ .ant-descriptions-item {
    padding-bottom: 8px;
  }
  /deep/.ant-descriptions-item-label {
    width: 60px;
    font-size: 15px;
    color: #0BB7AF;
    //font-weight: bolder;
    text-align: right;
  }
  /deep/.ant-descriptions-item-content {
    font-size: 15px;
    font-weight: bolder;
    color: #00b300;
  }
}
.technology {
  /deep/.ant-descriptions-view {
    margin-top: 8px;
  }
  /deep/ .ant-descriptions-item {
    padding-bottom: 8px;
  }
  /deep/.ant-descriptions-item-label {
    width: 350px;
    font-size: 16px;
    color: #0BB7AF;
    //font-weight: bolder;
    text-align: right;
  }
  /deep/.ant-descriptions-item-content {
    font-size: 16px;
    font-weight: bolder;
    color: #00b300;
  }
}
.ant-list {
  //border: .08333rem solid #20edfa;
  //box-shadow: 0 0 0.5rem #20edfa;
  .ant-list-item {
    border-bottom: 0 !important;
  }
}
.danger-list {
  overflow-y: auto;
  height: calc(100vh - 222px);
  &::-webkit-scrollbar{
    width: 5px;
    height: 1px;
  }
  &::-webkit-scrollbar-thumb {
    border-radius: 3px;
    //background: @primary-color;
    background-color: #0BB7AF ;
  }
  &::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 1px rgba(0,0,0,0);
    border-radius: 3px;
    //background: @primary-3;
    background-color: #06195e;
  }
}
.avatar-img {
  position: relative;
  width: 120px;
  display: flex;
  justify-content: center;
  align-items: center;

  .back-img {
    width: 100%;
    height: 100%;
  }

  .status-img {
    //background-color: rgba(255,255,255,0.1);
    position: absolute;
    width: 80px;
    height: 60px;
  }
}
.gas-img {
  position: relative;
  //width: 10rem;
  //min-height: 70px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  .alarm {
    margin: 0 8px;
    flex: content;
    width: 28%;
    //height: 500%;
    //margin: 0 1.2rem;
  }
  .status {
    margin: 0 8px;
    flex: content;
    position: relative;
    width:28%;
    //height: 50%;
    //margin: 0 1.2rem;
  }
}
.popover-inner{
  //width: 300px;
  color: #17da17;
  //background-color: rgba(98, 126, 227, 0.4);
  //border: .08333rem solid #20edfa;
  //box-shadow: 0 0 0.5rem #20edfa;
  .ant-descriptions{
    margin-top: 10px;
    /deep/.ant-descriptions-item-label {
      width: 100px;
      font-size: 15px;
      color: #0BB7AF;
      //font-weight: bolder;
      text-align: right;
    }
    /deep/.ant-descriptions-item-content {
      font-size: 15px;
      font-weight: bolder;
      color: #00b300;
    }
  }
}
.gas-content {
  .ant-list {
    /deep/.ant-row {
      display:flex;
      flex-wrap: wrap;
      /deep/.ant-card {
        min-width: 100%;
        height: 100%;
      }
    }
  }
}
</style>
<style lang="less">
.danger-tooltip {
  .ant-tooltip-content {
    .ant-tooltip-inner {
      width: 300px;
      background-color: rgba(6, 25, 94, 0.9);
      border: .08333rem solid #20edfa;
      //box-shadow: 0 0 0.5rem #20edfa;
    }
  }
}
.technology-tooltip {
  .ant-tooltip-content {
    .ant-tooltip-inner {
      width: 300px;
      background-color: rgba(6, 25, 94, 0.9);
      border: .08333rem solid #20edfa;
      //box-shadow: 0 0 0.5rem #20edfa;
    }
  }
}
</style>
