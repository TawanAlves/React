<template>
  <a-modal
    :title="title"
    :bodyStyle="{maxHeight:'700px',overflow:'auto'}"
    :width="700"
    :visible="visible"
    :maskClosable="false"
    @cancel="() => { $emit('cancel') }"
    :keyboard="false"
  >
    <template slot="footer">
      <a-button  @click="closeModal">取消</a-button>
    </template>
    <template v-if="records.accidentProcessVO">
      <div class="info-title">
        <span>事故提报信息</span>
      </div>
      <a-divider/>
    </template>
    <a-card :bordered="false" v-if="records.accidentReportVO">
      <a-descriptions :column="1" style="margin-left: 20px" :colon="true">
        <a-descriptions-item label="事故名称">{{ accidentReport.accidentName || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="发生时间">{{ accidentReport.occurrenceTime || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="事故类型">{{ accidentReport.accidentTypeName || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="上报人">{{ accidentReport.reportUserName || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="上报人电话">{{ accidentReport.reportUserPhone || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="发生地点">{{ accidentReport.occurrenceAddress || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="人员损伤情况">{{ accidentReport.peopleDamage || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="事故内容">{{ accidentReport.accidentReport || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="相关附件" :key="index">
          <template v-if="accidentReport.files && accidentReport.files.length > 0">
            <a
              size="small"
              @click="fileDownLoad(file.id, file.fileName)"
              :disabled="file.fileName===''"
              v-for="file in accidentReport.files"
              :key="file.id"
            >
              <span style="word-break: break-all;font-weight: normal!important;">{{ file.fileName }}</span>
            </a>
          </template>
          <template v-else>
            {{ '-' }}
          </template>
        </a-descriptions-item>
      </a-descriptions>
    </a-card>
    <template v-if="records.accidentProcessVO">
      <div class="info-title">
        <span>事故处理信息</span>
      </div>
      <a-divider/>
    </template>
    <a-card :bordered="false" v-if="records.accidentProcessVO">
      <a-descriptions :column="1" style="margin-left: 20px" :colon="true">
        <a-descriptions-item label="事故级别">{{ accidentProcess.accidentLevelName || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="事故造成的损失">{{ accidentProcess.accidentLoss || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="人员损伤情况">{{ accidentProcess.peopleDamage || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="事故原因分析">{{ accidentProcess.directCause || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="已采取的措施">{{ accidentProcess.accidentProcess || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="事故责任人">{{ accidentReport.dutyUserName || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="防范措施">{{ accidentProcess.preventiveMeasures || ' - ' }}</a-descriptions-item>
        <a-descriptions-item label="事故报告" :key="index">
          <template v-if="accidentProcess.files && accidentProcess.files.length > 0">
            <a
              size="small"
              @click="fileDownLoad(file.id, file.fileName)"
              :disabled="file.fileName===''"
              v-for="file in accidentProcess.files"
              :key="file.id"
            >
              <span style="word-break: break-all;font-weight: normal!important;">{{ file.fileName }}</span>
            </a>
          </template>
          <template v-else>
            {{ '-' }}
          </template>
        </a-descriptions-item>
      </a-descriptions>
    </a-card>
  </a-modal>
</template>

<script>
import { downloadFile } from '@/api/common'
export default {
  name: 'AccidentArchiveDetailModal',
  props: {
    visible: {
      type: Boolean,
      default: false,
      required: true
    },
    records: {
      type: Object,
      default: () => {},
      required: true
    },
    title: {
      type: String,
      default: '详细信息',
      required: false
    },
    column: {
      type: Number,
      default: 1,
      required: false
    }
  },
  data () {
    return {
      accidentProcess: {},
      accidentReport: {}
    }
  },
  watch: {
    records: {
      handler: function (value) {
        this.accidentReport = value.accidentReportVO
        this.accidentProcess = value.accidentProcessVO
      },
      deep: true
    }
  },
  methods: {
    fileDownLoad (id, name) {
      downloadFile(id, name)
    },
    closeModal() {
      console.log('close modal')
      this.$emit('cancel', false)
    }
  }
}
</script>

<style lang="less" scoped>
/deep/ .ant-card-head-title {
  font-weight: bolder;
  padding: 0!important;
}

/deep/ .ant-descriptions-item-label {
  //width: 170px;
  font-size: 15px;
  //font-weight: bolder;
  text-align: right;
  margin-right: 5px;
  //margin-left: 40px;
  flex: 2;
}

/deep/ .ant-descriptions-item-content {
  font-size: 15px;
  font-weight: normal;
  word-break: break-all;
  flex:7;
}

/deep/.ant-descriptions-item {
  display: flex;
}

.info-title {
  font-size: 16px;
  color: blue;

  span {
    margin-right: 10px;
  }
}
/deep/ .ant-divider-horizontal {
  margin: 7px 0;
}
</style>
