<template>
  <a-modal
    title="流程信息"
    :width="1200"
    :visible="visible"
    :footer="null"
    :keyboard="false"
    :maskClosable="false"
    @cancel="() => { $emit('cancel') }">
    <a-row :gutter="24">
      <a-col :span="12">
        <div class="flowchart">
          <p style="font-size: 16px;margin-left: 15px">流程示意图</p>
          <!-- <a-timeline class="timeline">
            <a-timeline-item v-for="d in timelineList" :key="d.key">
              <a-card slot="dot" size="small" :headStyle="{backgroundColor: d.color,color: 'white'}" type="inner" class="chartCard">
                <span slot="title"><a-icon type="user" v-if="d.content"/>{{ d.title }}</span>
                <p v-if="d.content">{{d.mode}}&nbsp;{{ d.time }}</p>
              </a-card>
              <br/><br/><br/><br/>{{ d.type }}<br/><br/><br/>
            </a-timeline-item>
          </a-timeline> -->
          <!--          <img :src="'http://localhost:8765/api/spang-flow/process/diagram-view?processInstanceId=' + model.processInstanceId" />-->
          <img :src="src" style="width:100%;height:auto"/>
        </div>
      </a-col>
      <a-col :span="12">
        <div class="flowchart">
          <p style="font-size: 16px;margin-left: 20px">流程进展</p>
          <!--            <a-list>-->
          <!--              <a-list-item :key="index" v-for="(item, index) in timelineList">-->
          <!--                <a-list-item-meta>-->
          <!--                  <div slot="title" v-if="item.content">-->
          <!--                    【{{ item.time }}】-->
          <!--                  </div>-->
          <!--                  <div slot="description">-->
          <!--                    {{ item.content }}-->
          <!--                  </div>-->
          <!--                </a-list-item-meta>-->
          <!--              </a-list-item>-->
          <!--            </a-list>-->
          <a-timeline style="margin-left: 8%">
            <a-timeline-item v-for="item in flowChartData" :key="item.key">
              {{ item.createTime }}
              <a-card size="small" type="inner" style="width: 400px;margin-top: 10px" :bordered="true">
                <p>{{ item.assigneeName }} 在 [{{ item.createTime }}] 开始处理 [{{ item.historyActivityName }}] 环节</p>
                <p v-if="item.historyActivityDurationTime">任务历时：[{{ item.historyActivityDurationTime }}]</p>
                <p v-if="item.comment">批复意见：[{{ item.comment }}]</p>
                <p v-if="item.endTime">结束时间：[{{ item.endTime }}]</p>
              </a-card>
            </a-timeline-item>
          </a-timeline>
        </div>
      </a-col>
    </a-row>
  </a-modal>
</template>

<script>
import { flow } from '@/api/safety'

export default {
  name: 'FlowChart',
  props: {
    visible: {
      type: Boolean,
      default: false
    },
    model: {
      type: Object,
      default: () => null
    }
  },
  data () {
    return {
      src: '',
      timelineList: [
        {
          title: '填报人',
          mode: '111',
          type: '提交',
          color: '#0BB7AF',
          content: '用户提交申请',
          time: '2020-08-23'

        },
        {
          title: '审批人',
          mode: '111',
          type: '审批',
          color: '#fe7632',
          content: '负责人1审批，意见：同意',
          time: '2020-08-23'
        },
        // {
        //   title: '责任人2',
        //   mode: '111',
        //   type: '审批',
        //   color: '#fe7632',
        //   content: '负责人2审批，意见：同意',
        //   time: '2020-08-23'
        // },
        // {
        //   title: '责任人3',
        //   mode: '111',
        //   type: '审批',
        //   color: '#0BB7AF',
        //   content: '负责人3审批，意见：同意',
        //   time: '2020-08-23'
        // },
        {
          title: '结束',
          color: '#1890ff'
        }
      ],
      mockList: [
        {
          startTime: '2020-12-02 15:47:32',
          userName: '管理员',
          endTime: '2020-12-02 15:48:00',
          event: '开始'
        },
        {
          startTime: '2020-12-02 15:48:00',
          userName: '管理员',
          endTime: '2020-12-02 16:58:00',
          totalTime: '1小时10分0秒',
          advice: '同意',
          event: '人事审批'
        },
        {
          startTime: '2020-12-02 15:47:32',
          userName: '管理员',
          endTime: '2020-12-02 15:48:00',
          totalTime: '2小时0分0秒',
          advice: '同意',
          event: '调整申请'
        },
        {
          startTime: '2020-12-02 15:47:32',
          userName: '管理员',
          endTime: '2020-12-02 15:48:00',
          event: '人事审批'
        }
      ],
      flowChartData: []
      // processDiagram: () => {

      // }
    }
  },
  created () {
    console.log('chart created+++++++')
    // 当 model 发生改变时，为表单设置值
    this.$watch('model', () => {
      if (this.model && Object.keys(this.model).length > 0) {
        this.src = 'http://localhost:8765/api/spang-flow/process/diagram-view?processInstanceId=' + this.model.processInstanceId
        flow.getFlowHistoryList({ processInstanceId: this.model.processInstanceId }).then(res => {
          this.flowChartData = res.data
        })
        // flow.getFlowDiagram({ processInstanceId: this.model.processInstanceId }).then(res => {
        //   console.log(res)
        // })
      }
    })
  },
  methods: {
  }
}
</script>
<style lang="less" scoped>
.flowchart {
  overflow-y: auto;
  height: 600px;

    .timeline {
      margin-top: 60px;
      margin-left: 50%;

      .chartCard {
        width: 200px;
        border-color: #0BB7AF;
        border-radius: 5px;
      }
  }
}
</style>
