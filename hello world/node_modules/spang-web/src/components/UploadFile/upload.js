import { fileUpLoad, downloadFile } from '@/api/common'

/**
 * 上传接口
 * @param fileJson
 * @param uploadResult
 */
export const uploadCustom = (fileJson, uploadResult) => {
  // 检查是否有文件
  if (fileJson.file) {
    // 设置为上传状态
    fileJson.status = 'uploading'
    // 清空上传进度
    fileJson.percent = 0
    // 开始上传回调
    if (uploadResult) {
      uploadResult(fileJson)
    }
    // 开始上传
    var requestForm = new FormData()

    requestForm.append('file', fileJson.file)

    fileUpLoad(requestForm).then(res => {
      if (res.success) {
        fileJson.status = 'done'
        fileJson.id = res.data.id
        fileJson.filePath = res.data.urlPath
        fileJson.name = res.data.originalFileName
        fileJson.file = undefined
        fileJson.url = process.env.VUE_APP_API_BASE_URL + '/spang-safety/file' + res.data.urlPath
      } else {
        fileJson.status = 'error'
      }
      if (uploadResult) {
        uploadResult(fileJson, res)
      }
    }).catch(err => {
      fileJson.status = 'error'
      if (uploadResult) {
        uploadResult(fileJson, err)
      }
    })
  }
}

export function uploadFile (file, callback) {
  // 开始上传
  var requestForm = new FormData()

  requestForm.append('file', file.file)

  fileUpLoad(requestForm).then(res => {
    if (res.success) {
      callback && callback(res.data.id)
    }
  }).catch(err => {
      callback && callback(null, err)
  })
}

/**
 * 下载接口
 * @param file
 * @param downloadPro
 */
export function downloadCustom (file, downloadPro) {
  downloadFile(file.id, file.name).then(res => {
    if (downloadPro) {
      downloadPro(file)
    }
  }).catch(err => {
    console.log(err)
    if (downloadPro) {
      downloadPro(file)
    }
  })
}
